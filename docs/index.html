<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voos Oficiais — Governo de Minas Gerais</title>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Tippy.js para tooltips -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <!-- PapaParse para CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  
  <style>
    :root {
      --primary-dark: #29435A;
      --primary-darker: #132837;
      --accent-red: #B93C42;
      --accent-bright: #DB233F;
      --background-light: #EEEFF5;
      --success-green: #28a745;
      --warning-yellow: #ffc107;
      --info-blue: #17a2b8;
      --secondary-blue: #2E5984;
      --secondary-green: #2E8B57;
      --secondary-purple: #6A5ACD;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-light);
      padding-bottom: 30px;
    }
    
    .main-header {
      background: linear-gradient(135deg, var(--primary-darker) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 25px 0;
      margin-bottom: 30px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      border-bottom: 4px solid var(--accent-red);
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .logo {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-bright) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(219, 35, 63, 0.3);
    }
    
    .header-title {
      font-weight: 800;
      font-size: 28px;
      margin: 0;
      letter-spacing: -0.5px;
    }
    
    .header-subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin: 5px 0 0 0;
    }
    
    .filter-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 30px;
      border-left: 5px solid var(--accent-red);
      border-top: 1px solid #e9ecef;
    }
    
    .filter-label {
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 8px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-control, .form-select {
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 12px 15px;
      font-size: 14px;
      transition: all 0.3s ease;
      height: 48px;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--accent-red);
      box-shadow: 0 0 0 3px rgba(185, 60, 66, 0.15);
    }
    
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
      height: 100%;
      min-height: 320px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--background-light);
    }
    
    .chart-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-dark);
      margin: 0;
    }
    
    .chart-wrapper {
      position: relative;
      height: 250px;
      width: 100%;
    }
    
    .table-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
    }
    
    .table-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
      color: white;
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .table-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
    }
    
    .table-badge {
      background: var(--accent-red);
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .table {
      margin: 0;
      width: 100%;
    }
    
    .table thead th {
      background-color: #f8f9fa;
      color: var(--primary-dark);
      font-weight: 700;
      border: none;
      padding: 18px 15px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    
    .table thead th:hover {
      background-color: rgba(41, 67, 90, 0.05);
    }
    
    .table tbody tr {
      transition: background-color 0.2s ease;
      border-bottom: 1px solid #f1f1f1;
    }
    
    .table tbody tr:hover {
      background-color: rgba(41, 67, 90, 0.04);
    }
    
    .table tbody td {
      padding: 16px 15px;
      vertical-align: middle;
      font-size: 14px;
    }
    
    .btn-primary-custom {
      background: linear-gradient(to right, var(--accent-red), var(--accent-bright));
      border: none;
      padding: 12px 30px;
      font-weight: 700;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 15px;
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary-custom:hover {
      background: linear-gradient(to right, var(--accent-bright), var(--accent-red));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(219, 35, 63, 0.25);
      color: white;
    }
    
    .btn-secondary-custom {
      background: white;
      border: 2px solid var(--primary-dark);
      color: var(--primary-dark);
      padding: 12px 30px;
      font-weight: 700;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 15px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-secondary-custom:hover {
      background-color: var(--primary-dark);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(41, 67, 90, 0.2);
    }
    
    .nav-tabs-container {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .nav-tabs {
      border: none;
      gap: 5px;
    }
    
    .nav-tabs .nav-link {
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-weight: 600;
      color: var(--primary-dark);
      transition: all 0.3s ease;
      font-size: 15px;
    }
    
    .nav-tabs .nav-link:hover {
      background-color: rgba(41, 67, 90, 0.05);
      color: var(--accent-red);
    }
    
    .nav-tabs .nav-link.active {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
      color: white;
    }
    
    .actions-container {
      background: white;
      border-radius: 12px;
      padding: 20px 25px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .export-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn-export {
      background: white;
      border: 2px solid var(--primary-dark);
      color: var(--primary-dark);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .btn-export:hover {
      background: var(--primary-dark);
      color: white;
      transform: translateY(-2px);
    }
    
    .social-share {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .social-share-label {
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 14px;
    }
    
    .btn-social {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: all 0.3s ease;
      text-decoration: none;
    }
    
    .btn-social:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      color: white;
    }
    
    .card-stats {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
      text-align: center;
    }
    
    .card-stats .value {
      font-size: 32px;
      font-weight: 800;
      color: var(--accent-red);
      margin: 10px 0;
    }
    
    .card-stats .label {
      font-size: 14px;
      color: var(--primary-dark);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .card-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }
    
    .dashboard-full {
      grid-column: 1 / -1;
    }
    
    .link-clicavel {
      color: var(--primary-dark);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-block;
      padding: 2px 4px;
      border-radius: 4px;
    }
    
    .link-clicavel:hover {
      color: var(--accent-red);
      background-color: rgba(185, 60, 66, 0.05);
      transform: translateY(-1px);
    }
    
    .badge-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .badge-realizado {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--secondary-green);
    }
    
    .badge-cancelado {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--accent-red);
    }
    
    .current-year-indicator {
      background: linear-gradient(135deg, var(--secondary-green) 0%, #2e8b47 100%);
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .footer {
      text-align: center;
      padding: 20px;
      color: var(--primary-dark);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      display: none;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(41, 67, 90, 0.1);
      border-radius: 50%;
      border-top-color: var(--accent-red);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    
    /* Status de atualização */
    .update-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: var(--primary-dark);
      padding: 6px 12px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.9);
    }
    
    .update-status.online {
      color: var(--secondary-green);
      background: rgba(52, 168, 83, 0.1);
    }
    
    .update-status.offline {
      color: var(--accent-red);
      background: rgba(234, 67, 53, 0.1);
    }
    
    .update-status.updating {
      color: var(--warning-yellow);
      background: rgba(255, 193, 7, 0.1);
    }
    
    .data-source-info {
      font-size: 0.8rem;
      color: var(--primary-dark);
      opacity: 0.8;
      margin-top: 5px;
    }
    
    @media (max-width: 992px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .card-stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .header-title {
        font-size: 22px;
      }
      
      .actions-container {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .export-buttons {
        width: 100%;
        justify-content: flex-start;
      }
      
      .social-share {
        width: 100%;
        justify-content: flex-start;
        margin-top: 15px;
      }
      
      .nav-tabs .nav-link {
        padding: 10px 15px;
        font-size: 14px;
      }
      
      .card-stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="ms-3">
      <p class="mb-1" id="loadingText">Carregando dados do GitHub...</p>
    </div>
  </div>

  <!-- Header Principal -->
  <header class="main-header">
    <div class="container">
      <div class="logo-container">
        <div class="logo">
          <i class="fas fa-plane"></i>
        </div>
        <div>
          <h1 class="header-title">Painel de Voos Oficiais</h1>
          <p class="header-subtitle">Governo do Estado de Minas Gerais - Transparência de Voos Oficiais</p>
          <div class="d-flex align-items-center gap-3 mt-2">
            <a href="https://dados.mg.gov.br" target="_blank" class="link-legislacao" style="color: white; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; opacity: 0.9; transition: opacity 0.3s;">
              <i class="fas fa-external-link-alt"></i> Portal de Dados Abertos
            </a>
            <a href="https://github.com/transparencia-mg/voos_oficiais_governador/tree/main/docs/data/normalized" target="_blank" class="link-legislacao" style="color: white; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; opacity: 0.9; transition: opacity 0.3s;">
              <i class="fab fa-github"></i> Repositório GitHub
            </a>
          </div>
        </div>
      </div>
      <div class="mt-3 d-flex justify-content-end">
        <div class="update-status online" id="updateStatus">
          <i class="fas fa-circle"></i>
          <span id="updateStatusText">Conectando ao GitHub...</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Conteúdo Principal -->
  <div class="container">
    <!-- Menu de Navegação -->
    <div class="nav-tabs-container">
      <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
            <i class="fas fa-chart-pie me-2"></i>Visão Geral
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="destinos-tab" data-bs-toggle="tab" data-bs-target="#destinos" type="button" role="tab">
            <i class="fas fa-map-marker-alt me-2"></i>Análise por Destino
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="download-tab" data-bs-toggle="tab" data-bs-target="#download" type="button" role="tab">
            <i class="fas fa-download me-2"></i>Download de Dados
          </button>
        </li>
      </ul>
    </div>

    <!-- Conteúdo das Abas -->
    <div class="tab-content" id="dashboardTabsContent">
      <!-- ABA 1: VISÃO GERAL -->
      <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <!-- Filtros -->
        <div class="filter-container">
          <div class="row">
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-ano" class="form-label filter-label">Ano</label>
                <select class="form-select" id="filter-ano">
                  <option value="2025">2025 (Mais recente)</option>
                  <option value="2021">2021</option>
                  <option value="all">Todos os anos</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-origem" class="form-label filter-label">Origem</label>
                <select class="form-select" id="filter-origem">
                  <option value="all">Todas as origens</option>
                  <!-- Carregado dinamicamente -->
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-destino" class="form-label filter-label">Destino</label>
                <select class="form-select" id="filter-destino">
                  <option value="all">Todos os destinos</option>
                  <!-- Carregado dinamicamente -->
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-situacao" class="form-label filter-label">Situação</label>
                <select class="form-select" id="filter-situacao">
                  <option value="all">Todas as situações</option>
                  <option value="REALIZADO">REALIZADO</option>
                  <option value="CANCELADO">CANCELADO</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="d-flex gap-3">
                <button class="btn-primary-custom" id="btn-apply">
                  <i class="fas fa-filter me-2"></i>Aplicar Filtros
                </button>
                <button class="btn-secondary-custom" id="btn-clear">
                  <i class="fas fa-redo me-2"></i>Limpar Filtros
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ações -->
        <div class="actions-container">
          <div class="export-buttons">
            <button class="btn-export" id="exportCSV">
              <i class="fas fa-file-csv"></i> Exportar CSV
            </button>
            <button class="btn-export" id="exportExcel">
              <i class="fas fa-file-excel"></i> Exportar Excel
            </button>
            <button class="btn-export" onclick="window.print()">
              <i class="fas fa-print"></i> Imprimir
            </button>
          </div>
          
          <div class="social-share">
            <span class="social-share-label">Compartilhar:</span>
            <a href="#" class="btn-social btn-facebook" style="background: #3b5998;">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="btn-social btn-twitter" style="background: #1da1f2;">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="btn-social btn-linkedin" style="background: #0077b5;">
              <i class="fab fa-linkedin-in"></i>
            </a>
          </div>
        </div>

        <!-- Cards de Estatísticas -->
        <div class="card-stats-grid">
          <div class="card-stats">
            <i class="fas fa-plane fa-2x" style="color: var(--accent-red);"></i>
            <div class="value" id="card-voos">—</div>
            <div class="label">Total de Voos</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-clock fa-2x" style="color: var(--secondary-blue);"></i>
            <div class="value" id="card-horas">—</div>
            <div class="label">Horas Voadas</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-users fa-2x" style="color: var(--secondary-green);"></i>
            <div class="value" id="card-passageiros">—</div>
            <div class="label">Passageiros Únicos</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-map-marker-alt fa-2x" style="color: var(--secondary-purple);"></i>
            <div class="value" id="card-destinos">—</div>
            <div class="label">Destinos Únicos</div>
          </div>
        </div>

        <!-- Gráficos -->
        <div class="dashboard-grid">
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Distribuição por Situação</h4>
              <div class="data-source-info">Fonte: GitHub/transparencia-mg</div>
            </div>
            <div class="chart-wrapper">
              <div id="chart-situacao" style="height:100%; width:100%;"></div>
            </div>
          </div>
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Top 10 Destinos Mais Frequentes</h4>
              <div class="data-source-info">Fonte: GitHub/transparencia-mg</div>
            </div>
            <div class="chart-wrapper">
              <div id="chart-destinos" style="height:100%; width:100%;"></div>
            </div>
          </div>
        </div>

        <!-- Tabela -->
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Detalhamento de Voos</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="current-year-indicator">
                <i class="fas fa-calendar-alt"></i> Ano: <span id="table-year">2025</span>
              </span>
              <span class="table-badge" id="voos-count">0 voos</span>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Origem</th>
                  <th>Destino</th>
                  <th>Passageiro</th>
                  <th>Horas de Voo</th>
                  <th>Situação</th>
                </tr>
              </thead>
              <tbody id="voos-table-body">
                <tr><td colspan="6" class="text-center">Carregando dados do GitHub...</td></tr>
              </tbody>
            </table>
          </div>
          <div class="p-3 border-top">
            <div class="d-flex justify-content-between align-items-center">
              <div id="pagination-info" class="text-muted">Mostrando 0 de 0 voos</div>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-primary" id="btn-prev" disabled>Anterior</button>
                <button class="btn btn-sm btn-outline-primary" id="btn-next" disabled>Próximo</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ABA 2: ANÁLISE POR DESTINO -->
      <div class="tab-pane fade" id="destinos" role="tabpanel">
        <!-- Filtros -->
        <div class="filter-container">
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="analise-ano" class="form-label filter-label">Ano</label>
                <select class="form-select" id="analise-ano">
                  <option value="2025">2025 (Mais recente)</option>
                  <option value="2021">2021</option>
                  <option value="all">Todos os anos</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="analise-destino" class="form-label filter-label">Destino Específico</label>
                <select class="form-select" id="analise-destino">
                  <option value="all">Todos os destinos</option>
                  <!-- Carregado dinamicamente -->
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="analise-situacao" class="form-label filter-label">Situação</label>
                <select class="form-select" id="analise-situacao">
                  <option value="all">Todas as situações</option>
                  <option value="REALIZADO">REALIZADO</option>
                  <option value="CANCELADO">CANCELADO</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <button class="btn-primary-custom" id="btn-analisar">
                <i class="fas fa-chart-bar me-2"></i>Gerar Análise
              </button>
            </div>
          </div>
        </div>

        <!-- Cards de Estatísticas -->
        <div class="card-stats-grid">
          <div class="card-stats">
            <i class="fas fa-plane fa-2x" style="color: var(--accent-red);"></i>
            <div class="value" id="analise-total">—</div>
            <div class="label">Voos para o Destino</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-percentage fa-2x" style="color: var(--secondary-green);"></i>
            <div class="value" id="analise-sucesso">—</div>
            <div class="label">Taxa de Sucesso</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-clock fa-2x" style="color: var(--secondary-blue);"></i>
            <div class="value" id="analise-horas">—</div>
            <div class="label">Horas Totais</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-user-friends fa-2x" style="color: var(--secondary-purple);"></i>
            <div class="value" id="analise-passageiros">—</div>
            <div class="label">Passageiros Únicos</div>
          </div>
        </div>

        <!-- Tabela de Análise -->
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Análise por Destino</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="current-year-indicator">
                <i class="fas fa-calendar-alt"></i> Período: <span id="analise-periodo">2025</span>
              </span>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Destino</th>
                  <th>Total de Voos</th>
                  <th>Realizados</th>
                  <th>Cancelados</th>
                  <th>Taxa de Sucesso</th>
                  <th>Horas Totais</th>
                  <th>Passageiros Únicos</th>
                </tr>
              </thead>
              <tbody id="analise-table-body">
                <tr><td colspan="7" class="text-center">Selecione os filtros e clique em "Gerar Análise"</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ABA 3: DOWNLOAD DE DADOS -->
      <div class="tab-pane fade" id="download" role="tabpanel">
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Download de Dados</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="table-badge">Dados Abertos</span>
            </div>
          </div>
          <div class="p-4">
            <div class="row">
              <div class="col-md-6">
                <div class="card-stats">
                  <i class="fas fa-file-csv fa-3x mb-3" style="color: var(--secondary-green);"></i>
                  <h4>Dados do GitHub</h4>
                  <p class="text-muted">Baixe os dados brutos diretamente do repositório GitHub em formato CSV.</p>
                  <div class="mt-3">
                    <a href="https://github.com/transparencia-mg/voos_oficiais_governador/tree/main/docs/data/normalized" target="_blank" class="btn-export w-100 d-block text-decoration-none">
                      <i class="fab fa-github me-2"></i>Acessar GitHub
                    </a>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card-stats">
                  <i class="fas fa-database fa-3x mb-3" style="color: var(--primary-dark);"></i>
                  <h4>Dados Processados</h4>
                  <p class="text-muted">Baixe os dados já processados e filtrados desta visualização.</p>
                  <div class="mt-3">
                    <button class="btn-export w-100" onclick="exportarDadosFiltrados()">
                      <i class="fas fa-download me-2"></i>Baixar Dados Atuais
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h5 class="mb-3">Arquivos Disponíveis</h5>
              <div id="arquivos-lista" class="list-group">
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Carregando lista de arquivos...</h6>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h5 class="mb-3">Estrutura dos Dados</h5>
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Campo</th>
                    <th>Descrição</th>
                    <th>Tipo</th>
                    <th>Exemplo</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>data</code></td>
                    <td>Data do voo</td>
                    <td>Data (YYYY-MM-DD)</td>
                    <td>2025-03-15</td>
                  </tr>
                  <tr>
                    <td><code>origem</code></td>
                    <td>Código do aeroporto de origem</td>
                    <td>Texto</td>
                    <td>CNF</td>
                  </tr>
                  <tr>
                    <td><code>destino</code></td>
                    <td>Código do aeroporto de destino</td>
                    <td>Texto</td>
                    <td>GRU</td>
                  </tr>
                  <tr>
                    <td><code>passageiro</code></td>
                    <td>Nome do passageiro</td>
                    <td>Texto</td>
                    <td>João Silva</td>
                  </tr>
                  <tr>
                    <td><code>horas_voo</code></td>
                    <td>Duração do voo em horas</td>
                    <td>Decimal</td>
                    <td>1.5</td>
                  </tr>
                  <tr>
                    <td><code>situacao</code></td>
                    <td>Situação do voo</td>
                    <td>Texto</td>
                    <td>REALIZADO</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <p>
        <i class="fas fa-database"></i> Dados atualizados do 
        <a href="https://github.com/transparencia-mg/voos_oficiais_governador/tree/main/docs/data/normalized" target="_blank" style="color: var(--primary-dark); text-decoration: none; font-weight: 600;">
          <i class="fab fa-github"></i> GitHub/transparencia-mg
        </a>
      </p>
      <p style="margin-top: 10px; font-size: 0.8rem;">
        © 2025 Governo de Minas Gerais. 
        <a href="https://dados.mg.gov.br" target="_blank" style="color: var(--primary-dark); text-decoration: none; font-weight: 600;">
          <i class="fas fa-external-link-alt"></i> dados.mg.gov.br
        </a>
      </p>
    </div>
  </footer>
  
  <script>
    // ============================================
    // CONFIGURAÇÃO INICIAL
    // ============================================
    
    // Configuração do GitHub
    const GITHUB_REPO = 'transparencia-mg/voos_oficiais_governador';
    const GITHUB_DATA_PATH = 'docs/data/normalized';
    const GITHUB_RAW_URL = 'https://raw.githubusercontent.com';
    
    // Variáveis globais
    let dadosVoos = [];
    let dadosFiltrados = [];
    let dadosCache = {
      voos: [],
      lastUpdate: null,
      anos: [],
      origens: [],
      destinos: [],
      situacoes: []
    };
    
    let currentPage = 1;
    const pageSize = 20;
    
    // Paleta de cores
    const palette = {
      primary: ['#29435A', '#2E5984', '#3A7CA5', '#4F9EC4'],
      accent: ['#B93C42', '#DB233F', '#E5586E', '#EF8A9E'],
      secondary: ['#2E8B57', '#3CB371', '#66CDAA', '#98F5FF'],
      additional: ['#6A5ACD', '#9370DB', '#BA55D3', '#DA70D6']
    };
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
      setupTooltips();
      loadInitialData();
    });
    
    function setupEventListeners() {
      // Visão Geral
      document.getElementById('btn-apply').addEventListener('click', aplicarFiltros);
      document.getElementById('btn-clear').addEventListener('click', limparFiltros);
      
      // Análise por Destino
      document.getElementById('btn-analisar').addEventListener('click', gerarAnalise);
      
      // Exportação
      document.getElementById('exportCSV').addEventListener('click', exportarParaCSV);
      document.getElementById('exportExcel').addEventListener('click', exportarParaExcel);
      
      // Paginação
      document.getElementById('btn-prev').addEventListener('click', () => mudarPagina(-1));
      document.getElementById('btn-next').addEventListener('click', () => mudarPagina(1));
      
      // Compartilhamento social
      setupSocialShare();
    }
    
    function setupTooltips() {
      tippy('.btn-export', {
        content: 'Exportar dados',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      tippy('.btn-social', {
        content: 'Compartilhar',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
    }
    
    function setupSocialShare() {
      document.querySelectorAll('.btn-social').forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          
          const url = encodeURIComponent(window.location.href);
          const title = encodeURIComponent('Painel de Voos Oficiais - Governo de Minas Gerais');
          const text = encodeURIComponent('Confira os dados atualizados de voos oficiais do Governo de MG');
          
          let shareUrl = '';
          
          if (this.classList.contains('btn-facebook')) {
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
          } else if (this.classList.contains('btn-twitter')) {
            shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
          } else if (this.classList.contains('btn-linkedin')) {
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
          }
          
          if (shareUrl) {
            window.open(shareUrl, '_blank', 'width=600,height=400');
          }
        });
      });
    }
    
    // ============================================
    // CARREGAMENTO DE DADOS DO GITHUB
    // ============================================
    
    async function loadInitialData() {
      showLoading('Carregando dados do GitHub...');
      updateStatus('updating', 'Conectando ao GitHub...');
      
      try {
        // Primeiro, carregar apenas o ano mais recente (2025)
        await carregarDadosPorAno('2025');
        
        hideLoading();
        updateStatus('online', 'Dados carregados');
        
        // Carregar opções de filtro
        carregarOpcoesFiltro();
        
        // Inicializar visualização
        aplicarFiltros();
        
        // Carregar lista de arquivos (em segundo plano)
        setTimeout(carregarListaArquivos, 1000);
        
      } catch (error) {
        console.error('Erro ao carregar dados:', error);
        hideLoading();
        updateStatus('offline', 'Erro ao carregar dados');
        
        // Usar dados de exemplo
        usarDadosExemplo();
        aplicarFiltros();
      }
    }
    
    async function carregarDadosPorAno(ano) {
      try {
        // URL direta para o arquivo CSV no GitHub
        const csvUrl = `${GITHUB_RAW_URL}/${GITHUB_REPO}/main/${GITHUB_DATA_PATH}/voos_${ano}.csv`;
        
        console.log(`Carregando dados de: ${csvUrl}`);
        
        const response = await fetch(csvUrl);
        
        if (!response.ok) {
          if (response.status === 404) {
            console.log(`Arquivo ${ano}.csv não encontrado, usando dados vazios`);
            dadosCache.voos = [];
            return;
          }
          throw new Error(`Erro HTTP: ${response.status}`);
        }
        
        const csvText = await response.text();
        
        // Parse do CSV
        const dados = await parseCSV(csvText);
        
        // Processar dados
        dadosCache.voos = processarDados(dados);
        dadosCache.lastUpdate = new Date();
        dadosCache.anos = [ano];
        
        console.log(`Carregados ${dadosCache.voos.length} voos de ${ano}`);
        
      } catch (error) {
        console.error(`Erro ao carregar dados de ${ano}:`, error);
        dadosCache.voos = [];
        throw error;
      }
    }
    
    async function parseCSV(csvText) {
      return new Promise((resolve, reject) => {
        Papa.parse(csvText, {
          header: true,
          skipEmptyLines: true,
          complete: (results) => {
            resolve(results.data);
          },
          error: (error) => {
            reject(error);
          }
        });
      });
    }
    
    function processarDados(dados) {
      return dados.map(item => {
        // Normalizar nomes de colunas
        const voo = {
          data: item.data || item.date || '',
          origem: item.origem || item.origin || '',
          destino: item.destino || item.destination || '',
          passageiro: item.passageiro || item.passenger || '',
          horas_voo: parseFloat(item.horas_voo || item.flight_hours || item.hours || 0),
          situacao: (item.situacao || item.status || '').toUpperCase(),
          ano: extrairAno(item.data || item.date)
        };
        
        return voo;
      }).filter(voo => voo.data && voo.origem && voo.destino);
    }
    
    function extrairAno(dataStr) {
      if (!dataStr) return '';
      const match = dataStr.match(/\b(\d{4})\b/);
      return match ? match[1] : '';
    }
    
    function carregarOpcoesFiltro() {
      const voos = dadosCache.voos;
      
      // Extrair anos únicos
      const anosUnicos = [...new Set(voos.map(v => v.ano).filter(Boolean))].sort().reverse();
      if (anosUnicos.length > 0) {
        dadosCache.anos = anosUnicos;
      }
      
      // Extrair origens únicas
      dadosCache.origens = [...new Set(voos.map(v => v.origem).filter(Boolean))].sort();
      
      // Extrair destinos únicos
      dadosCache.destinos = [...new Set(voos.map(v => v.destino).filter(Boolean))].sort();
      
      // Extrair situações únicas
      dadosCache.situacoes = [...new Set(voos.map(v => v.situacao).filter(Boolean))].sort();
      
      // Atualizar selects
      atualizarSelectsFiltro();
    }
    
    function atualizarSelectsFiltro() {
      // Atualizar select de anos
      const selectAno = document.getElementById('filter-ano');
      if (selectAno) {
        // Manter valor atual
        const valorAtual = selectAno.value;
        selectAno.innerHTML = '';
        
        // Adicionar opções
        dadosCache.anos.forEach(ano => {
          const option = document.createElement('option');
          option.value = ano;
          option.textContent = ano;
          if (ano === '2025') option.selected = true;
          selectAno.appendChild(option);
        });
        
        // Adicionar opção "Todos"
        const optionAll = document.createElement('option');
        optionAll.value = 'all';
        optionAll.textContent = 'Todos os anos';
        selectAno.appendChild(optionAll);
        
        // Restaurar valor se ainda existir
        if (valorAtual && dadosCache.anos.includes(valorAtual)) {
          selectAno.value = valorAtual;
        }
      }
      
      // Atualizar select de origens
      const selectOrigem = document.getElementById('filter-origem');
      if (selectOrigem && dadosCache.origens.length > 0) {
        const valorAtual = selectOrigem.value;
        selectOrigem.innerHTML = '<option value="all">Todas as origens</option>';
        
        dadosCache.origens.forEach(origem => {
          const option = document.createElement('option');
          option.value = origem;
          option.textContent = origem;
          selectOrigem.appendChild(option);
        });
        
        if (valorAtual && dadosCache.origens.includes(valorAtual)) {
          selectOrigem.value = valorAtual;
        }
      }
      
      // Atualizar select de destinos
      const selectDestino = document.getElementById('filter-destino');
      if (selectDestino && dadosCache.destinos.length > 0) {
        const valorAtual = selectDestino.value;
        selectDestino.innerHTML = '<option value="all">Todos os destinos</option>';
        
        dadosCache.destinos.forEach(destino => {
          const option = document.createElement('option');
          option.value = destino;
          option.textContent = destino;
          selectDestino.appendChild(option);
        });
        
        if (valorAtual && dadosCache.destinos.includes(valorAtual)) {
          selectDestino.value = valorAtual;
        }
      }
      
      // Atualizar select de destinos na aba de análise
      const selectAnaliseDestino = document.getElementById('analise-destino');
      if (selectAnaliseDestino && dadosCache.destinos.length > 0) {
        const valorAtual = selectAnaliseDestino.value;
        selectAnaliseDestino.innerHTML = '<option value="all">Todos os destinos</option>';
        
        dadosCache.destinos.forEach(destino => {
          const option = document.createElement('option');
          option.value = destino;
          option.textContent = destino;
          selectAnaliseDestino.appendChild(option);
        });
        
        if (valorAtual && dadosCache.destinos.includes(valorAtual)) {
          selectAnaliseDestino.value = valorAtual;
        }
      }
    }
    
    async function carregarListaArquivos() {
      try {
        const filesList = document.getElementById('arquivos-lista');
        if (!filesList) return;
        
        // Lista de anos disponíveis
        const anos = ['2025', '2021'];
        
        let html = '';
        
        anos.forEach(ano => {
          const url = `${GITHUB_RAW_URL}/${GITHUB_REPO}/main/${GITHUB_DATA_PATH}/${ano}.csv`;
          html += `
            <div class="list-group-item">
              <div class="d-flex w-100 justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">
                    <i class="fas fa-file-csv text-success me-2"></i>
                    ${ano}.csv
                  </h6>
                  <p class="mb-1">Dados de voos oficiais de ${ano}</p>
                </div>
                <div>
                  <a href="${url}" target="_blank" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-download"></i> Baixar
                  </a>
                </div>
              </div>
            </div>
          `;
        });
        
        filesList.innerHTML = html;
        
      } catch (error) {
        console.error('Erro ao carregar lista de arquivos:', error);
      }
    }
    
    // ============================================
    // FUNÇÕES DE UTILITÁRIOS
    // ============================================
    
    function showLoading(text = 'Carregando...') {
      const overlay = document.getElementById('loadingOverlay');
      const textElement = document.getElementById('loadingText');
      
      if (overlay) overlay.style.display = 'flex';
      if (textElement) textElement.textContent = text;
    }
    
    function hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      if (overlay) overlay.style.display = 'none';
    }
    
    function updateStatus(status, text) {
      const statusElement = document.getElementById('updateStatus');
      const textElement = document.getElementById('updateStatusText');
      
      if (statusElement && textElement) {
        statusElement.className = `update-status ${status}`;
        textElement.textContent = text;
      }
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return '';
      
      try {
        // Tentar converter para data
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) {
          // Se falhar, tentar formatar string no padrão YYYY-MM-DD
          const match = dateStr.match(/^(\d{4})-(\d{2})-(\d{2})$/);
          if (match) {
            return `${match[3]}/${match[2]}/${match[1]}`;
          }
          return dateStr;
        }
        return date.toLocaleDateString('pt-BR');
      } catch {
        return dateStr;
      }
    }
    
    function formatHoras(horas) {
      if (!horas && horas !== 0) return '—';
      const horasInt = Math.floor(horas);
      const minutos = Math.round((horas - horasInt) * 60);
      return `${horasInt}h${minutos > 0 ? ` ${minutos}m` : ''}`;
    }
    
    // ============================================
    // FUNÇÕES PARA DADOS DE EXEMPLO (FALLBACK)
    // ============================================
    
    function usarDadosExemplo() {
      const dadosExemplo = [
        { data: '2025-03-15', origem: 'CNF', destino: 'GRU', passageiro: 'João Silva', horas_voo: 1.5, situacao: 'REALIZADO', ano: '2025' },
        { data: '2025-03-18', origem: 'CNF', destino: 'GIG', passageiro: 'Maria Oliveira', horas_voo: 1.2, situacao: 'REALIZADO', ano: '20254' },
        { data: '2025-02-22', origem: 'UDI', destino: 'BSB', passageiro: 'Carlos Santos', horas_voo: 2.0, situacao: 'CANCELADO', ano: '2025' },
        { data: '2025-02-10', origem: 'CNF', destino: 'GRU', passageiro: 'Ana Costa', horas_voo: 1.5, situacao: 'REALIZADO', ano: '2025' },
        { data: '2025-01-05', origem: 'CNF', destino: 'VIX', passageiro: 'Roberto Alves', horas_voo: 1.8, situacao: 'REALIZADO', ano: '2025' },
        { data: '2025-12-20', origem: 'GRU', destino: 'BSB', passageiro: 'Patrícia Lima', horas_voo: 1.8, situacao: 'REALIZADO', ano: '2025' },
        { data: '2025-11-15', origem: 'CNF', destino: 'SDU', passageiro: 'Fernando Souza', horas_voo: 1.3, situacao: 'REALIZADO', ano: '2025' },
        { data: '2025-10-25', origem: 'BSB', destino: 'GRU', passageiro: 'Amanda Rocha', horas_voo: 2.1, situacao: 'REALIZADO', ano: '2025' }
      ];
      
      dadosCache.voos = dadosExemplo;
      dadosCache.anos = ['2025', '2021'];
      dadosCache.origens = ['CNF', 'UDI', 'GRU', 'BSB'];
      dadosCache.destinos = ['GRU', 'GIG', 'BSB', 'VIX', 'SDU'];
      dadosCache.situacoes = ['REALIZADO', 'CANCELADO'];
      dadosCache.lastUpdate = new Date();
      
      mostrarNotificacao('Usando dados de exemplo (GitHub pode estar temporariamente indisponível)', 'warning');
    }
    
    function mostrarNotificacao(mensagem, tipo = 'info') {
      // Criar notificação simples
      const notification = document.createElement('div');
      notification.className = `alert alert-${tipo} alert-dismissible fade show position-fixed`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      `;
      
      notification.innerHTML = `
        ${mensagem}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 5000);
    }
    
    // ============================================
    // FILTRAGEM E VISUALIZAÇÃO
    // ============================================
    
    function aplicarFiltros() {
      const ano = document.getElementById('filter-ano').value;
      const origem = document.getElementById('filter-origem').value;
      const destino = document.getElementById('filter-destino').value;
      const situacao = document.getElementById('filter-situacao').value;
      
      // Filtrar dados
      let dadosFiltrados = [...dadosCache.voos];
      
      if (ano !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.ano === ano);
      }
      
      if (origem !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.origem === origem);
      }
      
      if (destino !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.destino === destino);
      }
      
      if (situacao !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.situacao === situacao);
      }
      
      // Ordenar por data (mais recente primeiro)
      dadosFiltrados.sort((a, b) => b.data.localeCompare(a.data));
      
      // Atualizar visualização
      atualizarVisualizacao(dadosFiltrados);
      
      // Atualizar ano na tabela
      document.getElementById('table-year').textContent = ano === 'all' ? 'Todos' : ano;
    }
    
    function limparFiltros() {
      document.getElementById('filter-ano').value = '2025';
      document.getElementById('filter-origem').value = 'all';
      document.getElementById('filter-destino').value = 'all';
      document.getElementById('filter-situacao').value = 'all';
      
      aplicarFiltros();
    }
    
    function atualizarVisualizacao(dados) {
      // Armazenar dados filtrados globalmente
      dadosFiltrados = dados;
      currentPage = 1;
      
      // Atualizar estatísticas
      atualizarEstatisticas(dados);
      
      // Atualizar gráficos
      atualizarGraficos(dados);
      
      // Atualizar tabela
      atualizarTabela(dados);
      
      // Atualizar paginação
      atualizarPaginacao(dados.length);
    }
    
    function atualizarEstatisticas(dados) {
      const totalVoos = dados.length;
      const totalHoras = dados.reduce((sum, item) => sum + (item.horas_voo || 0), 0);
      const passageirosUnicos = new Set(dados.map(item => item.passageiro)).size;
      const destinosUnicos = new Set(dados.map(item => item.destino)).size;
      const realizados = dados.filter(item => item.situacao === 'REALIZADO').length;
      
      document.getElementById('card-voos').textContent = totalVoos.toLocaleString('pt-BR');
      document.getElementById('card-horas').textContent = formatHoras(totalHoras);
      document.getElementById('card-passageiros').textContent = passageirosUnicos.toLocaleString('pt-BR');
      document.getElementById('card-destinos').textContent = destinosUnicos.toLocaleString('pt-BR');
      document.getElementById('voos-count').textContent = `${totalVoos} voos (${realizados} realizados)`;
    }
    
    function atualizarGraficos(dados) {
      if (dados.length === 0) {
        // Gráfico vazio para situação
        Plotly.newPlot('chart-situacao', [{
          labels: ['Sem dados'],
          values: [100],
          type: 'pie',
          marker: { colors: [palette.primary[0]] }
        }], {
          title: '',
          paper_bgcolor: 'transparent',
          plot_bgcolor: 'transparent'
        });
        
        // Gráfico vazio para destinos
        Plotly.newPlot('chart-destinos', [{
          x: ['Sem dados'],
          y: [0],
          type: 'bar',
          marker: { color: palette.accent[0] }
        }], {
          title: '',
          margin: { t: 10, r: 30, b: 80, l: 60 },
          paper_bgcolor: 'transparent',
          plot_bgcolor: 'transparent'
        });
        return;
      }
      
      // Gráfico de situação (pizza)
      const situacaoCount = dados.reduce((acc, voo) => {
        acc[voo.situacao] = (acc[voo.situacao] || 0) + 1;
        return acc;
      }, {});
      
      const situacaoTrace = {
        labels: Object.keys(situacaoCount),
        values: Object.values(situacaoCount),
        type: 'pie',
        marker: { colors: [palette.secondary[0], palette.accent[0]] }
      };
      
      Plotly.newPlot('chart-situacao', [situacaoTrace], {
        title: '',
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Gráfico de top destinos (barras)
      const destinosCount = {};
      dados.forEach(item => {
        destinosCount[item.destino] = (destinosCount[item.destino] || 0) + 1;
      });
      
      const topDestinos = Object.entries(destinosCount)
        .map(([destino, quantidade]) => ({ destino, quantidade }))
        .sort((a, b) => b.quantidade - a.quantidade)
        .slice(0, 10);
      
      const destinosTrace = {
        x: topDestinos.map(d => d.destino),
        y: topDestinos.map(d => d.quantidade),
        type: 'bar',
        marker: { color: palette.accent[0] }
      };
      
      Plotly.newPlot('chart-destinos', [destinosTrace], {
        title: '',
        margin: { t: 10, r: 30, b: 80, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
    }
    
    function atualizarTabela(dados) {
      const startIndex = (currentPage - 1) * pageSize;
      const endIndex = startIndex + pageSize;
      const dadosPagina = dados.slice(startIndex, endIndex);
      
      const tbody = document.getElementById('voos-table-body');
      
      if (dados.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">Nenhum voo encontrado com os filtros aplicados</td></tr>';
        return;
      }
      
      let html = '';
      
      dadosPagina.forEach(voo => {
        html += `
          <tr>
            <td>${formatDate(voo.data)}</td>
            <td>${voo.origem}</td>
            <td>${voo.destino}</td>
            <td>${voo.passageiro}</td>
            <td>${formatHoras(voo.horas_voo)}</td>
            <td>
              <span class="badge-status ${voo.situacao === 'REALIZADO' ? 'badge-realizado' : 'badge-cancelado'}">
                <i class="fas ${voo.situacao === 'REALIZADO' ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                ${voo.situacao}
              </span>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }
    
    function atualizarPaginacao(totalItens) {
      const totalPages = Math.ceil(totalItens / pageSize);
      const infoElement = document.getElementById('pagination-info');
      const btnPrev = document.getElementById('btn-prev');
      const btnNext = document.getElementById('btn-next');
      
      const startItem = (currentPage - 1) * pageSize + 1;
      const endItem = Math.min(currentPage * pageSize, totalItens);
      
      infoElement.textContent = `Mostrando ${startItem}-${endItem} de ${totalItens} voos`;
      
      btnPrev.disabled = currentPage === 1;
      btnNext.disabled = currentPage === totalPages || totalPages === 0;
    }
    
    function mudarPagina(direction) {
      const totalPages = Math.ceil(dadosFiltrados.length / pageSize);
      const newPage = currentPage + direction;
      
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        atualizarTabela(dadosFiltrados);
        atualizarPaginacao(dadosFiltrados.length);
      }
    }
    
    // ============================================
    // ANÁLISE POR DESTINO
    // ============================================
    
    function gerarAnalise() {
      const ano = document.getElementById('analise-ano').value;
      const destino = document.getElementById('analise-destino').value;
      const situacao = document.getElementById('analise-situacao').value;
      
      // Filtrar dados
      let dadosFiltrados = [...dadosCache.voos];
      
      if (ano !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.ano === ano);
      }
      
      if (destino !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.destino === destino);
      }
      
      if (situacao !== 'all') {
        dadosFiltrados = dadosFiltrados.filter(v => v.situacao === situacao);
      }
      
      // Agrupar por destino
      const destinosMap = {};
      
      dadosFiltrados.forEach(voo => {
        if (!destinosMap[voo.destino]) {
          destinosMap[voo.destino] = {
            destino: voo.destino,
            total: 0,
            realizados: 0,
            cancelados: 0,
            horas: 0,
            passageiros: new Set()
          };
        }
        
        destinosMap[voo.destino].total++;
        destinosMap[voo.destino].horas += voo.horas_voo || 0;
        destinosMap[voo.destino].passageiros.add(voo.passageiro);
        
        if (voo.situacao === 'REALIZADO') {
          destinosMap[voo.destino].realizados++;
        } else if (voo.situacao === 'CANCELADO') {
          destinosMap[voo.destino].cancelados++;
        }
      });
      
      // Converter para array e calcular estatísticas
      const destinosArray = Object.values(destinosMap).map(d => ({
        destino: d.destino,
        total: d.total,
        realizados: d.realizados,
        cancelados: d.cancelados,
        taxaSucesso: d.total > 0 ? ((d.realizados / d.total) * 100).toFixed(1) : '0.0',
        horas: formatHoras(d.horas),
        passageiros: d.passageiros.size
      }));
      
      // Ordenar por total (decrescente)
      destinosArray.sort((a, b) => b.total - a.total);
      
      // Atualizar estatísticas gerais
      if (destino === 'all') {
        const totalVoos = destinosArray.reduce((sum, d) => sum + d.total, 0);
        const totalRealizados = destinosArray.reduce((sum, d) => sum + d.realizados, 0);
        const taxaSucessoGeral = totalVoos > 0 ? ((totalRealizados / totalVoos) * 100).toFixed(1) : '0.0';
        const totalHoras = destinosArray.reduce((sum, d) => {
          const horas = parseFloat(d.horas) || 0;
          return sum + horas;
        }, 0);
        const totalPassageiros = new Set(dadosFiltrados.map(v => v.passageiro)).size;
        
        document.getElementById('analise-total').textContent = totalVoos.toLocaleString('pt-BR');
        document.getElementById('analise-sucesso').textContent = `${taxaSucessoGeral}%`;
        document.getElementById('analise-horas').textContent = formatHoras(totalHoras);
        document.getElementById('analise-passageiros').textContent = totalPassageiros.toLocaleString('pt-BR');
      } else {
        const dadosDestino = destinosArray.find(d => d.destino === destino);
        if (dadosDestino) {
          document.getElementById('analise-total').textContent = dadosDestino.total.toLocaleString('pt-BR');
          document.getElementById('analise-sucesso').textContent = `${dadosDestino.taxaSucesso}%`;
          document.getElementById('analise-horas').textContent = dadosDestino.horas;
          document.getElementById('analise-passageiros').textContent = dadosDestino.passageiros.toLocaleString('pt-BR');
        }
      }
      
      // Atualizar tabela
      atualizarTabelaAnalise(destinosArray);
      
      // Atualizar período
      document.getElementById('analise-periodo').textContent = ano === 'all' ? 'Todos' : ano;
    }
    
    function atualizarTabelaAnalise(dados) {
      const tbody = document.getElementById('analise-table-body');
      
      if (dados.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center">Nenhum dado encontrado com os filtros aplicados</td></tr>';
        return;
      }
      
      let html = '';
      
      dados.forEach(item => {
        html += `
          <tr>
            <td>${item.destino}</td>
            <td>${item.total.toLocaleString('pt-BR')}</td>
            <td>${item.realizados.toLocaleString('pt-BR')}</td>
            <td>${item.cancelados.toLocaleString('pt-BR')}</td>
            <td>${item.taxaSucesso}%</td>
            <td>${item.horas}</td>
            <td>${item.passageiros.toLocaleString('pt-BR')}</td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
    }
    
    // ============================================
    // EXPORTAÇÃO DE DADOS
    // ============================================
    
    function exportarParaCSV() {
      if (dadosFiltrados.length === 0) {
        mostrarNotificacao('Nenhum dado para exportar', 'warning');
        return;
      }
      
      const headers = ['Data', 'Origem', 'Destino', 'Passageiro', 'Horas de Voo', 'Situação', 'Ano'];
      const csvRows = [];
      
      // Cabeçalho
      csvRows.push(headers.join(','));
      
      // Dados
      dadosFiltrados.forEach(voo => {
        const row = [
          voo.data,
          voo.origem,
          voo.destino,
          voo.passageiro,
          voo.horas_voo,
          voo.situacao,
          voo.ano
        ].map(value => {
          // Escapar vírgulas e aspas
          if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
            return `"${value.replace(/"/g, '""')}"`;
          }
          return value;
        });
        
        csvRows.push(row.join(','));
      });
      
      const csvContent = csvRows.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      const ano = document.getElementById('filter-ano').value;
      const filename = `voos_oficiais_${ano === 'all' ? 'todos' : ano}_${new Date().toISOString().slice(0,10)}.csv`;
      
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      mostrarNotificacao(`Exportado ${dadosFiltrados.length} voos para CSV`, 'success');
    }
    
    function exportarParaExcel() {
      mostrarNotificacao('Para exportar em Excel, baixe o CSV e abra no Excel', 'info');
    }
    
    function exportarDadosFiltrados() {
      exportarParaCSV();
    }
    
    console.log('Painel de Voos Oficiais carregado com sucesso!');
  </script>
</body>
</html>
