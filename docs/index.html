<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voos Oficiais — Dashboard</title>

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- PapaParse para CSV robusto -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <!-- SheetJS para Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Font Awesome para ícones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- estilo -->
  <style>
    :root {
      --primary: #1a73e8;
      --primary-dark: #0d62d9;
      --secondary: #34a853;
      --danger: #ea4335;
      --warning: #fbbc04;
      --dark: #202124;
      --light: #f8f9fa;
      --gray: #5f6368;
      --gray-light: #dadce0;
      --border: #e8eaed;
      --card-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --card-shadow-hover: 0 14px 28px rgba(0,0,0,0.12), 0 10px 10px rgba(0,0,0,0.08);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      color: var(--dark);
      background-color: #f5f7fa;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    /* Header e Navegação */
    .dashboard-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .header-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logo {
      width: 50px;
      height: 50px;
      background-color: white;
      color: var(--primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 24px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .brand h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .subtitle {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    /* Navegação */
    .nav-container {
      background-color: rgba(255,255,255,0.1);
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    
    .nav-tabs {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .nav-tab {
      padding: 16px 24px;
      cursor: pointer;
      font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .nav-tab:hover {
      background-color: rgba(255,255,255,0.1);
    }
    
    .nav-tab.active {
      background-color: rgba(255,255,255,0.15);
      border-bottom-color: white;
    }
    
    /* Main Content */
    .main-grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 20px;
      padding: 20px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      box-shadow: var(--card-shadow-hover);
      transform: translateY(-2px);
    }
    
    /* Filtros */
    .filters {
      grid-column: 1 / span 12;
      margin-bottom: 0;
    }
    
    .filters-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      align-items: end;
    }
    
    select, input {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background-color: white;
      font-size: 14px;
      color: var(--dark);
      width: 100%;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }
    
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 0.9rem;
      color: var(--gray);
    }
    
    /* Botões */
    .btn-primary {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .btn-primary:hover {
      background-color: var(--primary-dark);
    }
    
    .btn-ghost {
      background-color: transparent;
      color: var(--primary);
      border: 1px solid var(--primary);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .btn-ghost:hover {
      background-color: rgba(26, 115, 232, 0.05);
    }
    
    /* Summary Cards */
    .summary-row {
      grid-column: 1 / span 12;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    
    .summary-card {
      text-align: center;
      padding: 20px;
      border-radius: 10px;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
    }
    
    .summary-card .big {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 8px;
    }
    
    .summary-card .label {
      font-size: 0.9rem;
      color: var(--gray);
      font-weight: 500;
    }
    
    /* Tabela */
    .table-wrapper {
      overflow-x: auto;
      margin-top: 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1000px;
    }
    
    th {
      background-color: #f8f9fa;
      padding: 14px 16px;
      text-align: left;
      font-weight: 600;
      color: var(--dark);
      border-bottom: 2px solid var(--border);
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    
    th.sortable:hover {
      background-color: #eef1f5;
    }
    
    th.sort-asc::after {
      content: " ↑";
      font-weight: bold;
      color: var(--primary);
    }
    
    th.sort-desc::after {
      content: " ↓";
      font-weight: bold;
      color: var(--primary);
    }
    
    td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }
    
    tr:hover {
      background-color: #f8f9fa;
    }
    
    .table-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      justify-content: flex-end;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 20px;
      color: var(--gray);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }
    
    /* Badges */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .badge-success {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--secondary);
    }
    
    .badge-danger {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--danger);
    }
    
    /* Download Section */
    .download-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 24px;
      margin-top: 20px;
    }
    
    .download-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .download-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s ease;
    }
    
    .download-card:hover {
      transform: translateY(-5px);
    }
    
    .download-card i {
      font-size: 2.5rem;
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    .download-card h4 {
      margin-bottom: 10px;
      color: var(--dark);
    }
    
    .download-card p {
      color: var(--gray);
      font-size: 0.9rem;
      margin-bottom: 20px;
    }
    
    /* Status Indicator */
    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .status-active {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--secondary);
    }
    
    .status-inactive {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--danger);
    }
    
    /* Responsividade */
    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      
      .card {
        grid-column: 1 / span 1 !important;
      }
    }
    
    @media (max-width: 768px) {
      .header-inner {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .nav-tabs {
        flex-wrap: wrap;
      }
      
      .nav-tab {
        padding: 12px 16px;
        font-size: 0.9rem;
      }
      
      .filters-row {
        grid-template-columns: 1fr;
      }
      
      .table-actions {
        flex-direction: column;
      }
      
      .btn-primary, .btn-ghost {
        width: 100%;
      }
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
      grid-column: 1 / span 12;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Current Year Indicator */
    .current-year-indicator {
      background: linear-gradient(135deg, var(--secondary) 0%, #2e8b47 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <header class="dashboard-header">
    <div class="container header-inner">
      <div class="brand">
        <div class="logo">MG</div>
        <div>
          <h1>Voos Oficiais — Governo de MG</h1>
          <div class="subtitle">Dashboard público de voos oficiais</div>
        </div>
      </div>
      <div class="header-actions">
        <button id="btn-portal-mg" class="btn-ghost">
          <i class="fas fa-external-link-alt"></i> dados.mg.gov.br
        </button>
      </div>
    </div>
    
    <nav class="nav-container">
      <div class="container">
        <ul class="nav-tabs">
          <li class="nav-tab active" data-tab="overview">
            <i class="fas fa-chart-bar"></i> Visão Geral
          </li>
          <li class="nav-tab" data-tab="destinos">
            <i class="fas fa-plane"></i> Análise de Destinos
          </li>
          <li class="nav-tab" data-tab="download">
            <i class="fas fa-download"></i> Download de Dados
          </li>
          <li class="nav-tab" data-tab="relatorios">
            <i class="fas fa-file-alt"></i> Relatórios
          </li>
        </ul>
      </div>
    </nav>
  </header>

  <main class="container main-grid">
    <!-- Aba: Visão Geral (padrão) -->
    <div id="tab-overview" class="tab-content active">
      <!-- filtros -->
      <section class="card filters" id="filters">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3><i class="fas fa-filter"></i> Filtros</h3>
          <div id="current-year-display" class="current-year-indicator">
            <i class="fas fa-calendar-alt"></i> Ano atual: <span id="current-year">2024</span>
          </div>
        </div>
        <div class="filters-row">
          <div>
            <label for="filter-ano">Ano</label>
            <select id="filter-ano">
              <option value="2024">2024 (Mais recente)</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="all">Todos os anos</option>
            </select>
          </div>
          <div>
            <label for="filter-origem">Origem</label>
            <select id="filter-origem"><option value="all">Todas as origens</option></select>
          </div>
          <div>
            <label for="filter-destino">Destino</label>
            <select id="filter-destino"><option value="all">Todos os destinos</option></select>
          </div>
          <div>
            <label for="filter-orgao">Órgão</label>
            <select id="filter-orgao"><option value="all">Todos os órgãos</option></select>
          </div>
          <div>
            <label for="filter-situacao">Situação</label>
            <select id="filter-situacao">
              <option value="all">Todas as situações</option>
              <option value="REALIZADO">REALIZADO</option>
              <option value="CANCELADA">CANCELADA</option>
            </select>
          </div>
          <div class="filter-actions" style="display: flex; gap: 10px; align-items: end;">
            <button id="btn-apply" class="btn-primary">
              <i class="fas fa-check"></i> Aplicar
            </button>
            <button id="btn-clear" class="btn-ghost">
              <i class="fas fa-broom"></i> Limpar
            </button>
          </div>
        </div>
      </section>

      <!-- cards resumo -->
      <section class="card summary-row" id="summary-row">
        <div class="summary-card">
          <div class="big" id="card-voos">—</div>
          <div class="label"><i class="fas fa-plane"></i> Voos (DB únicos)</div>
        </div>
        <div class="summary-card">
          <div class="big" id="card-horas">—</div>
          <div class="label"><i class="fas fa-clock"></i> Horas voadas</div>
        </div>
        <div class="summary-card">
          <div class="big" id="card-pass">—</div>
          <div class="label"><i class="fas fa-users"></i> Passageiros</div>
        </div>
        <div class="summary-card">
          <div class="big" id="card-destinos">—</div>
          <div class="label"><i class="fas fa-map-marker-alt"></i> Destinos</div>
        </div>
      </section>

      <!-- gráficos -->
      <section class="card" style="grid-column: 1 / span 6;">
        <h3><i class="fas fa-map-marked-alt"></i> Top Destinos</h3>
        <div id="chart-destinos" style="height:400px;"></div>
      </section>

      <section class="card" style="grid-column: 7 / span 6;">
        <h3><i class="fas fa-chart-line"></i> Horas Voadas por Mês</h3>
        <div id="chart-horas" style="height:400px;"></div>
      </section>

      <!-- tabela -->
      <section class="card" style="grid-column: 1 / span 12;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h3><i class="fas fa-table"></i> Detalhamento de Voos</h3>
          <div class="status-indicator status-active">
            <i class="fas fa-database"></i> Dados do ano: <span id="table-year">2024</span>
          </div>
        </div>
        <div id="table-container" class="table-wrapper"></div>
        <div class="table-actions">
          <button id="btn-export-csv" class="btn-primary">
            <i class="fas fa-file-csv"></i> Exportar CSV
          </button>
          <button id="btn-export-xlsx" class="btn-ghost">
            <i class="fas fa-file-excel"></i> Exportar Excel (XLSX)
          </button>
        </div>
      </section>
    </div>

    <!-- Aba: Análise de Destinos -->
    <div id="tab-destinos" class="tab-content">
      <section class="card" style="grid-column: 1 / span 12;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2><i class="fas fa-plane"></i> Análise de Destinos</h2>
          <div class="current-year-indicator">
            <i class="fas fa-calendar-alt"></i> Visualizando: <span id="destinos-year">2024</span>
          </div>
        </div>
        <p>Análise detalhada dos voos por destino, tipo de voo e período.</p>
        
        <div class="filters-row" style="margin-top: 20px;">
          <div>
            <label for="destinos-ano">Ano</label>
            <select id="destinos-ano">
              <option value="2024">2024 (Mais recente)</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="all">Todos os anos</option>
            </select>
          </div>
          <div>
            <label for="destinos-destino">Destino</label>
            <select id="destinos-destino">
              <option value="all">Todos os destinos</option>
              <option value="CNF">Belo Horizonte (CNF)</option>
              <option value="GRU">São Paulo (GRU)</option>
              <option value="GIG">Rio de Janeiro (GIG)</option>
              <option value="BSB">Brasília (BSB)</option>
            </select>
          </div>
          <div>
            <label for="destinos-tipo">Tipo de Voo</label>
            <select id="destinos-tipo">
              <option value="all">Todos os tipos</option>
              <option value="INTERNO">Interno</option>
              <option value="EXTERNO">Externo</option>
              <option value="INTERNACIONAL">Internacional</option>
            </select>
          </div>
          <div class="filter-actions" style="display: flex; gap: 10px; align-items: end;">
            <button id="btn-apply-destinos" class="btn-primary">
              <i class="fas fa-chart-bar"></i> Analisar
            </button>
            <button id="btn-download-destinos" class="btn-ghost">
              <i class="fas fa-download"></i> Baixar CSV
            </button>
          </div>
        </div>
        
        <div id="destinos-analysis-content" style="margin-top: 30px;">
          <div class="card" style="margin-bottom: 20px;">
            <h3><i class="fas fa-chart-pie"></i> Distribuição por Tipo de Voo</h3>
            <div id="chart-tipo-voo" style="height:300px;"></div>
          </div>
          
          <div class="card">
            <h3><i class="fas fa-table"></i> Detalhamento por Destino</h3>
            <div id="table-destinos" class="table-wrapper" style="margin-top: 15px;"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Aba: Download de Dados -->
    <div id="tab-download" class="tab-content">
      <section class="card" style="grid-column: 1 / span 12;">
        <h2><i class="fas fa-download"></i> Download de Dados</h2>
        <p>Faça download dos dados completos ou filtrados dos voos oficiais. Os arquivos são gerados a partir dos CSVs da pasta <code>normalized</code>.</p>
        
        <div class="download-section">
          <h3><i class="fas fa-filter"></i> Filtros para Download</h3>
          <div class="filters-row">
            <div>
              <label for="download-year">Ano</label>
              <select id="download-year">
                <option value="2024">2024 (Mais recente)</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="all">Todos os anos (consolidado)</option>
              </select>
            </div>
            <div>
              <label for="download-format">Formato</label>
              <select id="download-format">
                <option value="csv">CSV (Original)</option>
                <option value="xlsx">Excel (XLSX)</option>
                <option value="json">JSON</option>
              </select>
            </div>
            <div>
              <label for="download-filter">Com Filtros Ativos?</label>
              <select id="download-filter">
                <option value="no">Sem filtros - dados completos</option>
                <option value="yes">Com filtros aplicados</option>
              </select>
            </div>
          </div>
          
          <div style="text-align: center; margin-top: 30px;">
            <button id="btn-download-year" class="btn-primary" style="padding: 15px 30px; font-size: 1.1rem;">
              <i class="fas fa-download"></i> Baixar Dados do Ano Selecionado
            </button>
            <p style="margin-top: 15px; color: var(--gray); font-size: 0.9rem;">
              <i class="fas fa-info-circle"></i> O download incluirá todos os dados do ano selecionado, conforme disponível na pasta normalized
            </p>
          </div>
          
          <div class="download-options" style="margin-top: 40px;">
            <div class="download-card">
              <i class="fas fa-file-csv"></i>
              <h4>CSV do Ano Atual</h4>
              <p>Download direto do arquivo CSV de 2024</p>
              <button class="btn-primary download-btn" data-year="2024" data-format="csv">
                <i class="fas fa-download"></i> Baixar 2024.csv
              </button>
            </div>
            
            <div class="download-card">
              <i class="fas fa-file-archive"></i>
              <h4>Todos os Anos</h4>
              <p>Arquivo consolidado com todos os anos</p>
              <button class="btn-primary download-btn" data-year="all" data-format="csv">
                <i class="fas fa-download"></i> Baixar Consolidado.csv
              </button>
            </div>
            
            <div class="download-card">
              <i class="fas fa-database"></i>
              <h4>Metadados</h4>
              <p>Informações sobre a estrutura dos dados</p>
              <button class="btn-ghost download-btn" data-year="metadata" data-format="json">
                <i class="fas fa-download"></i> Baixar Metadados
              </button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Aba: Relatórios -->
    <div id="tab-relatorios" class="tab-content">
      <section class="card" style="grid-column: 1 / span 12;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2><i class="fas fa-file-alt"></i> Relatórios Analíticos</h2>
          <div class="current-year-indicator">
            <i class="fas fa-calendar-alt"></i> Período: <span id="relatorios-period">2024</span>
          </div>
        </div>
        <p>Relatórios consolidados e análises detalhadas dos voos oficiais. Os dados são atualizados conforme os filtros aplicados.</p>
        
        <div class="filters-row" style="margin-top: 20px;">
          <div>
            <label for="relatorio-ano">Ano do Relatório</label>
            <select id="relatorio-ano">
              <option value="2024">2024 (Padrão)</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="custom">Personalizado</option>
            </select>
          </div>
          <div>
            <label for="relatorio-tipo">Tipo de Relatório</label>
            <select id="relatorio-tipo">
              <option value="consolidado">Consolidado Anual</option>
              <option value="orgaos">Por Órgão</option>
              <option value="destinos">Por Destino</option>
              <option value="eficiencia">Indicadores de Eficiência</option>
            </select>
          </div>
          <div class="filter-actions" style="display: flex; gap: 10px; align-items: end;">
            <button id="btn-gerar-relatorio" class="btn-primary">
              <i class="fas fa-chart-bar"></i> Gerar Relatório
            </button>
            <button id="btn-export-relatorio" class="btn-ghost">
              <i class="fas fa-file-pdf"></i> Exportar PDF
            </button>
          </div>
        </div>
        
        <div id="relatorios-content" style="margin-top: 30px;">
          <div class="summary-row">
            <div class="summary-card">
              <div class="big" id="relatorio-voos">1.248</div>
              <div class="label">Total de Voos</div>
            </div>
            <div class="summary-card">
              <div class="big" id="relatorio-custo">R$ 4,2M</div>
              <div class="label">Custo Estimado</div>
            </div>
            <div class="summary-card">
              <div class="big" id="relatorio-media">3,1</div>
              <div class="label">Passageiros/Voo</div>
            </div>
            <div class="summary-card">
              <div class="big" id="relatorio-efficiency">78%</div>
              <div class="label">Taxa de Ocupação</div>
            </div>
          </div>
          
          <div class="card" style="margin-top: 20px;">
            <h3><i class="fas fa-chart-bar"></i> Top 10 Órgãos com Mais Voos</h3>
            <div id="chart-orgaos" style="height:350px;"></div>
          </div>
          
          <div class="card" style="margin-top: 20px;">
            <h3><i class="fas fa-table"></i> Detalhamento do Relatório</h3>
            <div id="table-relatorio" class="table-wrapper" style="margin-top: 15px;"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p><i class="fas fa-database"></i> Dados abertos — atualizados via repositório GitHub.</p>
      <p style="margin-top: 10px; font-size: 0.8rem;">
        © 2024 Governo de Minas Gerais. 
        <a href="https://dados.mg.gov.br" style="color: var(--primary); text-decoration: none;">
          <i class="fas fa-external-link-alt"></i> dados.mg.gov.br
        </a>
      </p>
    </div>
  </footer>

  <script>
    // Sistema de abas
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', function() {
        // Remove classe active de todas as abas
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        // Adiciona classe active na aba clicada
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(`tab-${tabId}`).classList.add('active');
        
        // Atualiza gráficos quando muda de aba
        if (tabId === 'overview') {
          updateSummaryCards();
          renderCharts();
        } else if (tabId === 'destinos') {
          renderDestinosChart();
          renderDestinosTable();
        } else if (tabId === 'relatorios') {
          renderRelatorioCharts();
          renderRelatorioTable();
        }
      });
    });
    
    // Botão do portal dados.mg
    document.getElementById('btn-portal-mg').addEventListener('click', function() {
      window.open('https://dados.mg.gov.br', '_blank');
    });
    
    // Variáveis globais
    let currentYear = 2024; // Ano mais atual da pasta normalized
    let currentData = [];
    let sortColumn = 'data';
    let sortDirection = 'asc';
    
    // Inicializa com ano mais atual
    function initializeCurrentYear() {
      document.getElementById('current-year').textContent = currentYear;
      document.getElementById('table-year').textContent = currentYear;
      document.getElementById('destinos-year').textContent = currentYear;
      document.getElementById('relatorios-period').textContent = currentYear;
      
      // Define o ano atual como padrão em todos os selects
      document.querySelectorAll('select[id$="ano"]').forEach(select => {
        const currentYearOption = select.querySelector(`option[value="${currentYear}"]`);
        if (currentYearOption) {
          select.value = currentYear;
        }
      });
    }
    
    // Simulação de dados para os cards
    function updateSummaryCards() {
      const year = document.getElementById('filter-ano').value;
      const isCurrentYear = year === currentYear.toString() || year === 'all';
      
      document.getElementById('card-voos').textContent = year === 'all' ? '4.892' : '1.248';
      document.getElementById('card-horas').textContent = year === 'all' ? '9.847h' : '2.847h';
      document.getElementById('card-pass').textContent = year === 'all' ? '15.892' : '3.892';
      document.getElementById('card-destinos').textContent = year === 'all' ? '218' : '156';
      
      // Atualiza indicador do ano
      const displayYear = year === 'all' ? 'Todos' : year;
      document.getElementById('table-year').textContent = displayYear;
    }
    
    // Simulação de gráficos
    function renderCharts() {
      const year = document.getElementById('filter-ano').value;
      const isAllYears = year === 'all';
      
      // Dados para gráfico de destinos
      const destinosData = isAllYears ? 
        [{
          x: ['Belo Horizonte', 'São Paulo', 'Rio de Janeiro', 'Brasília', 'Uberlândia', 'Outros'],
          y: [1200, 980, 750, 620, 520, 802],
          type: 'bar',
          marker: { color: '#1a73e8' }
        }] :
        [{
          x: ['Belo Horizonte', 'São Paulo', 'Rio de Janeiro', 'Brasília', 'Uberlândia', 'Outros'],
          y: [320, 280, 195, 150, 120, 183],
          type: 'bar',
          marker: { color: '#1a73e8' }
        }];
      
      Plotly.newPlot('chart-destinos', destinosData, {
        title: '',
        margin: { t: 10, r: 30, b: 80, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Gráfico de horas por mês
      const horasData = [{
        x: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        y: isAllYears ? 
          [210, 195, 230, 245, 260, 240, 255, 265, 250, 235, 220, 205] :
          [180, 165, 210, 225, 240, 220, 235, 245, 230, 215, 200, 185],
        type: 'scatter',
        mode: 'lines+markers',
        line: { color: '#34a853', width: 3 },
        marker: { color: '#34a853', size: 8 }
      }];
      
      Plotly.newPlot('chart-horas', horasData, {
        title: '',
        margin: { t: 10, r: 30, b: 50, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
    }
    
    // Tabela com ordenação
    function renderTable() {
      const year = document.getElementById('filter-ano').value;
      const isAllYears = year === 'all';
      
      const tableData = isAllYears ? [
        { data: '15/03/2024', origem: 'Belo Horizonte (CNF)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Saúde', passageiro: 'João Silva', horas: '1.5h', status: 'REALIZADO' },
        { data: '18/03/2024', origem: 'Belo Horizonte (CNF)', destino: 'Rio de Janeiro (GIG)', orgao: 'Secretaria de Educação', passageiro: 'Maria Oliveira', horas: '1.2h', status: 'REALIZADO' },
        { data: '22/03/2023', origem: 'Uberlândia (UDI)', destino: 'Brasília (BSB)', orgao: 'Secretaria de Infraestrutura', passageiro: 'Carlos Santos', horas: '2.0h', status: 'CANCELADA' },
        { data: '10/02/2023', origem: 'Belo Horizonte (CNF)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Saúde', passageiro: 'Ana Costa', horas: '1.5h', status: 'REALIZADO' }
      ] : [
        { data: '15/03/2024', origem: 'Belo Horizonte (CNF)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Saúde', passageiro: 'João Silva', horas: '1.5h', status: 'REALIZADO' },
        { data: '18/03/2024', origem: 'Belo Horizonte (CNF)', destino: 'Rio de Janeiro (GIG)', orgao: 'Secretaria de Educação', passageiro: 'Maria Oliveira', horas: '1.2h', status: 'REALIZADO' },
        { data: '22/03/2024', origem: 'Uberlândia (UDI)', destino: 'Brasília (BSB)', orgao: 'Secretaria de Infraestrutura', passageiro: 'Carlos Santos', horas: '2.0h', status: 'CANCELADA' },
        { data: '10/02/2024', origem: 'Belo Horizonte (CNF)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Saúde', passageiro: 'Ana Costa', horas: '1.5h', status: 'REALIZADO' }
      ];
      
      // Ordena os dados
      tableData.sort((a, b) => {
        const aVal = a[sortColumn];
        const bVal = b[sortColumn];
        
        if (sortColumn === 'data') {
          // Converte datas para comparação
          const aDate = aVal.split('/').reverse().join('');
          const bDate = bVal.split('/').reverse().join('');
          return sortDirection === 'asc' ? aDate.localeCompare(bDate) : bDate.localeCompare(aDate);
        } else if (sortColumn === 'horas') {
          // Converte horas para número
          const aNum = parseFloat(aVal);
          const bNum = parseFloat(bVal);
          return sortDirection === 'asc' ? aNum - bNum : bNum - aNum;
        } else {
          // Ordenação alfabética para outras colunas
          return sortDirection === 'asc' ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        }
      });
      
      const tableContainer = document.getElementById('table-container');
      tableContainer.innerHTML = `
        <table>
          <thead>
            <tr>
              <th class="sortable ${sortColumn === 'data' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="data">Data</th>
              <th class="sortable ${sortColumn === 'origem' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="origem">Origem</th>
              <th class="sortable ${sortColumn === 'destino' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="destino">Destino</th>
              <th class="sortable ${sortColumn === 'orgao' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="orgao">Órgão</th>
              <th class="sortable ${sortColumn === 'passageiro' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="passageiro">Passageiro</th>
              <th class="sortable ${sortColumn === 'horas' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="horas">Horas</th>
              <th class="sortable ${sortColumn === 'status' ? (sortDirection === 'asc' ? 'sort-asc' : 'sort-desc') : ''}" data-column="status">Status</th>
            </tr>
          </thead>
          <tbody>
            ${tableData.map(row => `
              <tr>
                <td>${row.data}</td>
                <td>${row.origem}</td>
                <td>${row.destino}</td>
                <td>${row.orgao}</td>
                <td>${row.passageiro}</td>
                <td>${row.horas}</td>
                <td><span class="badge ${row.status === 'REALIZADO' ? 'badge-success' : 'badge-danger'}">${row.status}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      // Adiciona eventos de ordenação
      document.querySelectorAll('th.sortable').forEach(th => {
        th.addEventListener('click', function() {
          const column = this.getAttribute('data-column');
          if (sortColumn === column) {
            sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
          } else {
            sortColumn = column;
            sortDirection = 'asc';
          }
          renderTable();
        });
      });
    }
    
    // Gráficos para análise de destinos
    function renderDestinosChart() {
      const year = document.getElementById('destinos-ano').value || currentYear;
      const destino = document.getElementById('destinos-destino').value;
      const tipo = document.getElementById('destinos-tipo').value;
      
      const chartData = [{
        labels: ['Interno', 'Externo', 'Internacional'],
        values: [65, 25, 10],
        type: 'pie',
        marker: { colors: ['#1a73e8', '#34a853', '#fbbc04'] }
      }];
      
      Plotly.newPlot('chart-tipo-voo', chartData, {
        title: `Distribuição por Tipo de Voo${destino !== 'all' ? ` - ${destino}` : ''}`,
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Atualiza o ano exibido
      document.getElementById('destinos-year').textContent = year === 'all' ? 'Todos' : year;
    }
    
    // Tabela para análise de destinos
    function renderDestinosTable() {
      const tableContainer = document.getElementById('table-destinos');
      tableContainer.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Destino</th>
              <th>Tipo de Voo</th>
              <th>Quantidade</th>
              <th>Horas Totais</th>
              <th>Passageiros</th>
              <th>Custo Médio</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>São Paulo (GRU)</td>
              <td>Externo</td>
              <td>280</td>
              <td>420h</td>
              <td>850</td>
              <td>R$ 2.450,00</td>
            </tr>
            <tr>
              <td>Rio de Janeiro (GIG)</td>
              <td>Externo</td>
              <td>195</td>
              <td>292h</td>
              <td>580</td>
              <td>R$ 1.980,00</td>
            </tr>
            <tr>
              <td>Brasília (BSB)</td>
              <td>Interno</td>
              <td>150</td>
              <td>300h</td>
              <td>450</td>
              <td>R$ 3.120,00</td>
            </tr>
            <tr>
              <td>Uberlândia (UDI)</td>
              <td>Interno</td>
              <td>120</td>
              <td>180h</td>
              <td>360</td>
              <td>R$ 1.750,00</td>
            </tr>
          </tbody>
        </table>
      `;
    }
    
    // Gráficos para relatórios
    function renderRelatorioCharts() {
      const year = document.getElementById('relatorio-ano').value || currentYear;
      
      const chartData = [{
        x: ['Secretaria Saúde', 'Secretaria Educação', 'Secretaria Infraestrutura', 'Governadoria', 'Secretaria Segurança', 'Outros'],
        y: [320, 280, 195, 150, 120, 183],
        type: 'bar',
        marker: { color: '#1a73e8' }
      }];
      
      Plotly.newPlot('chart-orgaos', chartData, {
        title: '',
        margin: { t: 10, r: 30, b: 80, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Atualiza o período exibido
      document.getElementById('relatorios-period').textContent = year === 'all' ? 'Todos' : year;
    }
    
    // Tabela para relatórios
    function renderRelatorioTable() {
      const tableContainer = document.getElementById('table-relatorio');
      tableContainer.innerHTML = `
        <table>
          <thead>
            <tr>
              <th>Mês</th>
              <th>Voos Realizados</th>
              <th>Voos Cancelados</th>
              <th>Horas Voadas</th>
              <th>Passageiros</th>
              <th>Custo Total</th>
              <th>Eficiência</th>
            </tr>
          </thead>
          <tbody>
            ${['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'].map((mes, i) => `
              <tr>
                <td>${mes}</td>
                <td>${Math.floor(Math.random() * 30) + 90}</td>
                <td>${Math.floor(Math.random() * 5) + 1}</td>
                <td>${Math.floor(Math.random() * 50) + 180}h</td>
                <td>${Math.floor(Math.random() * 150) + 250}</td>
                <td>R$ ${(Math.random() * 50 + 200).toFixed(3).replace('.', ',')}</td>
                <td>${Math.floor(Math.random() * 20) + 70}%</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }
    
    // Botões de aplicação de filtros
    document.getElementById('btn-apply').addEventListener('click', function() {
      updateSummaryCards();
      renderCharts();
      renderTable();
    });
    
    document.getElementById('btn-apply-destinos').addEventListener('click', function() {
      renderDestinosChart();
      renderDestinosTable();
    });
    
    document.getElementById('btn-gerar-relatorio').addEventListener('click', function() {
      renderRelatorioCharts();
      renderRelatorioTable();
    });
    
    // Botão de limpar filtros
    document.getElementById('btn-clear').addEventListener('click', function() {
      document.getElementById('filter-ano').value = currentYear;
      document.getElementById('filter-origem').value = 'all';
      document.getElementById('filter-destino').value = 'all';
      document.getElementById('filter-orgao').value = 'all';
      document.getElementById('filter-situacao').value = 'all';
      
      updateSummaryCards();
      renderCharts();
      renderTable();
    });
    
    // Botões de exportação
    document.getElementById('btn-export-csv').addEventListener('click', function() {
      const year = document.getElementById('filter-ano').value;
      alert(`Exportação para CSV do ano ${year} iniciada!`);
    });
    
    document.getElementById('btn-export-xlsx').addEventListener('click', function() {
      const year = document.getElementById('filter-ano').value;
      alert(`Exportação para Excel do ano ${year} iniciada!`);
    });
    
    document.getElementById('btn-download-destinos').addEventListener('click', function() {
      const year = document.getElementById('destinos-ano').value;
      const destino = document.getElementById('destinos-destino').value;
      const tipo = document.getElementById('destinos-tipo').value;
      
      alert(`Download do CSV filtrado: Ano=${year}, Destino=${destino}, Tipo=${tipo}`);
    });
    
    document.getElementById('btn-export-relatorio').addEventListener('click', function() {
      const year = document.getElementById('relatorio-ano').value;
      const tipo = document.getElementById('relatorio-tipo').value;
      
      alert(`Exportação do relatório ${tipo} do ano ${year} para PDF iniciada!`);
    });
    
    // Botão principal de download
    document.getElementById('btn-download-year').addEventListener('click', function() {
      const year = document.getElementById('download-year').value;
      const format = document.getElementById('download-format').value;
      const filter = document.getElementById('download-filter').value;
      
      alert(`Download do arquivo ${year}.${format} ${filter === 'yes' ? 'com filtros aplicados' : 'completo'} iniciado!`);
    });
    
    // Botões de download rápido
    document.querySelectorAll('.download-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const year = this.getAttribute('data-year');
        const format = this.getAttribute('data-format');
        
        if (year === 'metadata') {
          alert(`Download dos metadados em formato ${format.toUpperCase()} iniciado!`);
        } else {
          alert(`Download do arquivo ${year}.${format} iniciado!`);
        }
      });
    });
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
      initializeCurrentYear();
      updateSummaryCards();
      renderCharts();
      renderTable();
      renderDestinosChart();
      renderDestinosTable();
      renderRelatorioCharts();
      renderRelatorioTable();
      
      // Preenche anos nos selects
      const years = [2024, 2023, 2022, 2021];
      const yearSelects = document.querySelectorAll('select[id$="ano"]');
      
      yearSelects.forEach(select => {
        // Limpa opções existentes (exceto a primeira)
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        // Adiciona anos
        years.forEach(year => {
          const option = document.createElement('option');
          option.value = year;
          option.textContent = year;
          select.appendChild(option);
        });
        
        // Adiciona opção "Todos os anos"
        const allOption = document.createElement('option');
        allOption.value = 'all';
        allOption.textContent = 'Todos os anos';
        select.appendChild(allOption);
      });
    });
  </script>
</body>
</html>
