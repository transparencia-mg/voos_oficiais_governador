<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Voos Oficiais — Governo de Minas Gerais</title>
  
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <!-- Tippy.js para tooltips -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  
  <style>
    :root {
      --primary-dark: #29435A;
      --primary-darker: #132837;
      --accent-red: #B93C42;
      --accent-bright: #DB233F;
      --background-light: #EEEFF5;
      --success-green: #28a745;
      --warning-yellow: #ffc107;
      --info-blue: #17a2b8;
      --secondary-blue: #2E5984;
      --secondary-green: #2E8B57;
      --secondary-purple: #6A5ACD;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-light);
      padding-bottom: 30px;
    }
    
    .main-header {
      background: linear-gradient(135deg, var(--primary-darker) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 25px 0;
      margin-bottom: 30px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      border-bottom: 4px solid var(--accent-red);
    }
    
    .logo-container {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .logo {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--accent-red) 0%, var(--accent-bright) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(219, 35, 63, 0.3);
    }
    
    .header-title {
      font-weight: 800;
      font-size: 28px;
      margin: 0;
      letter-spacing: -0.5px;
    }
    
    .header-subtitle {
      font-size: 16px;
      opacity: 0.9;
      margin: 5px 0 0 0;
    }
    
    .filter-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 30px;
      border-left: 5px solid var(--accent-red);
      border-top: 1px solid #e9ecef;
    }
    
    .filter-label {
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 8px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-control, .form-select {
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 12px 15px;
      font-size: 14px;
      transition: all 0.3s ease;
      height: 48px;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: var(--accent-red);
      box-shadow: 0 0 0 3px rgba(185, 60, 66, 0.15);
    }
    
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
      height: 100%;
      min-height: 320px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--background-light);
    }
    
    .chart-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-dark);
      margin: 0;
    }
    
    .chart-wrapper {
      position: relative;
      height: 250px;
      width: 100%;
    }
    
    .table-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
    }
    
    .table-header {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
      color: white;
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .table-title {
      font-size: 18px;
      font-weight: 700;
      margin: 0;
    }
    
    .table-badge {
      background: var(--accent-red);
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .table {
      margin: 0;
      width: 100%;
    }
    
    .table thead th {
      background-color: #f8f9fa;
      color: var(--primary-dark);
      font-weight: 700;
      border: none;
      padding: 18px 15px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    
    .table thead th:hover {
      background-color: rgba(41, 67, 90, 0.05);
    }
    
    .table tbody tr {
      transition: background-color 0.2s ease;
      border-bottom: 1px solid #f1f1f1;
    }
    
    .table tbody tr:hover {
      background-color: rgba(41, 67, 90, 0.04);
    }
    
    .table tbody td {
      padding: 16px 15px;
      vertical-align: middle;
      font-size: 14px;
    }
    
    .btn-primary-custom {
      background: linear-gradient(to right, var(--accent-red), var(--accent-bright));
      border: none;
      padding: 12px 30px;
      font-weight: 700;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 15px;
      color: white;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary-custom:hover {
      background: linear-gradient(to right, var(--accent-bright), var(--accent-red));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(219, 35, 63, 0.25);
      color: white;
    }
    
    .btn-secondary-custom {
      background: white;
      border: 2px solid var(--primary-dark);
      color: var(--primary-dark);
      padding: 12px 30px;
      font-weight: 700;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 15px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-secondary-custom:hover {
      background-color: var(--primary-dark);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(41, 67, 90, 0.2);
    }
    
    .nav-tabs-container {
      background: white;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    
    .nav-tabs {
      border: none;
      gap: 5px;
    }
    
    .nav-tabs .nav-link {
      border: none;
      border-radius: 8px;
      padding: 12px 25px;
      font-weight: 600;
      color: var(--primary-dark);
      transition: all 0.3s ease;
      font-size: 15px;
    }
    
    .nav-tabs .nav-link:hover {
      background-color: rgba(41, 67, 90, 0.05);
      color: var(--accent-red);
    }
    
    .nav-tabs .nav-link.active {
      background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
      color: white;
    }
    
    .actions-container {
      background: white;
      border-radius: 12px;
      padding: 20px 25px;
      margin-bottom: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .export-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .btn-export {
      background: white;
      border: 2px solid var(--primary-dark);
      color: var(--primary-dark);
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .btn-export:hover {
      background: var(--primary-dark);
      color: white;
      transform: translateY(-2px);
    }
    
    .social-share {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    .social-share-label {
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 14px;
    }
    
    .btn-social {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: all 0.3s ease;
      text-decoration: none;
    }
    
    .btn-social:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      color: white;
    }
    
    .card-stats {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
      text-align: center;
    }
    
    .card-stats .value {
      font-size: 32px;
      font-weight: 800;
      color: var(--accent-red);
      margin: 10px 0;
    }
    
    .card-stats .label {
      font-size: 14px;
      color: var(--primary-dark);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .card-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }
    
    .dashboard-full {
      grid-column: 1 / -1;
    }
    
    .link-clicavel {
      color: var(--primary-dark);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-block;
      padding: 2px 4px;
      border-radius: 4px;
    }
    
    .link-clicavel:hover {
      color: var(--accent-red);
      background-color: rgba(185, 60, 66, 0.05);
      transform: translateY(-1px);
    }
    
    .badge-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
    }
    
    .badge-realizado {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--secondary-green);
    }
    
    .badge-cancelado {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--accent-red);
    }
    
    .current-year-indicator {
      background: linear-gradient(135deg, var(--secondary-green) 0%, #2e8b47 100%);
      color: white;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .footer {
      text-align: center;
      padding: 20px;
      color: var(--primary-dark);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      display: none;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(41, 67, 90, 0.1);
      border-radius: 50%;
      border-top-color: var(--accent-red);
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 992px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .card-stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .header-title {
        font-size: 22px;
      }
      
      .actions-container {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .export-buttons {
        width: 100%;
        justify-content: flex-start;
      }
      
      .social-share {
        width: 100%;
        justify-content: flex-start;
        margin-top: 15px;
      }
      
      .nav-tabs .nav-link {
        padding: 10px 15px;
        font-size: 14px;
      }
      
      .card-stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
  </div>

  <!-- Header Principal -->
  <header class="main-header">
    <div class="container">
      <div class="logo-container">
        <div class="logo">
          <i class="fas fa-plane"></i>
        </div>
        <div>
          <h1 class="header-title">Painel de Voos Oficiais</h1>
          <p class="header-subtitle">Governo do Estado de Minas Gerais - Transparência de Voos Oficiais</p>
          <a href="https://dados.mg.gov.br" target="_blank" class="link-legislacao" style="color: white; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 5px; margin-top: 10px; opacity: 0.9; transition: opacity 0.3s;">
            <i class="fas fa-external-link-alt"></i> Portal de Dados Abertos de Minas Gerais
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Conteúdo Principal -->
  <div class="container">
    <!-- Menu de Navegação -->
    <div class="nav-tabs-container">
      <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
            <i class="fas fa-chart-pie me-2"></i>Visão Geral
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="destinos-tab" data-bs-toggle="tab" data-bs-target="#destinos" type="button" role="tab">
            <i class="fas fa-map-marker-alt me-2"></i>Destinos
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="download-tab" data-bs-toggle="tab" data-bs-target="#download" type="button" role="tab">
            <i class="fas fa-download me-2"></i>Download de Dados
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="relatorios-tab" data-bs-toggle="tab" data-bs-target="#relatorios" type="button" role="tab">
            <i class="fas fa-file-alt me-2"></i>Relatórios
          </button>
        </li>
      </ul>
    </div>

    <!-- Conteúdo das Abas -->
    <div class="tab-content" id="dashboardTabsContent">
      <!-- ABA 1: VISÃO GERAL -->
      <div class="tab-pane fade show active" id="overview" role="tabpanel">
        <!-- Filtros -->
        <div class="filter-container">
          <div class="row">
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-ano" class="form-label filter-label">Ano</label>
                <select class="form-select" id="filter-ano">
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                  <option value="all">Todos os anos</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-origem" class="form-label filter-label">Origem</label>
                <select class="form-select" id="filter-origem">
                  <option value="all">Todas as origens</option>
                  <option value="CNF">Belo Horizonte (CNF)</option>
                  <option value="GRU">São Paulo (GRU)</option>
                  <option value="GIG">Rio de Janeiro (GIG)</option>
                  <option value="BSB">Brasília (BSB)</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-destino" class="form-label filter-label">Destino</label>
                <select class="form-select" id="filter-destino">
                  <option value="all">Todos os destinos</option>
                  <option value="CNF">Belo Horizonte (CNF)</option>
                  <option value="GRU">São Paulo (GRU)</option>
                  <option value="GIG">Rio de Janeiro (GIG)</option>
                  <option value="BSB">Brasília (BSB)</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filter-situacao" class="form-label filter-label">Situação</label>
                <select class="form-select" id="filter-situacao">
                  <option value="all">Todas as situações</option>
                  <option value="REALIZADO">REALIZADO</option>
                  <option value="CANCELADA">CANCELADA</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="d-flex gap-3">
                <button class="btn-primary-custom" id="btn-apply">
                  <i class="fas fa-filter me-2"></i>Aplicar Filtros
                </button>
                <button class="btn-secondary-custom" id="btn-clear">
                  <i class="fas fa-redo me-2"></i>Limpar Filtros
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ações -->
        <div class="actions-container">
          <div class="export-buttons">
            <button class="btn-export" id="exportCSV">
              <i class="fas fa-file-csv"></i> CSV
            </button>
            <button class="btn-export" id="exportExcel">
              <i class="fas fa-file-excel"></i> Excel
            </button>
            <button class="btn-export" id="exportPDF">
              <i class="fas fa-file-pdf"></i> PDF
            </button>
            <button class="btn-export" id="btn-print">
              <i class="fas fa-print"></i> Imprimir
            </button>
          </div>
          
          <div class="social-share">
            <span class="social-share-label">Compartilhar:</span>
            <a href="#" class="btn-social btn-facebook" style="background: #3b5998;">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="btn-social btn-twitter" style="background: #1da1f2;">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="btn-social btn-linkedin" style="background: #0077b5;">
              <i class="fab fa-linkedin-in"></i>
            </a>
            <a href="#" class="btn-social btn-whatsapp" style="background: #25d366;">
              <i class="fab fa-whatsapp"></i>
            </a>
          </div>
        </div>

        <!-- Cards de Estatísticas -->
        <div class="card-stats-grid">
          <div class="card-stats">
            <i class="fas fa-plane fa-2x" style="color: var(--accent-red);"></i>
            <div class="value" id="card-voos">1.248</div>
            <div class="label">Voos (DB únicos)</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-clock fa-2x" style="color: var(--secondary-blue);"></i>
            <div class="value" id="card-horas">2.847h</div>
            <div class="label">Horas Voadas</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-users fa-2x" style="color: var(--secondary-green);"></i>
            <div class="value" id="card-pass">3.892</div>
            <div class="label">Passageiros</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-map-marker-alt fa-2x" style="color: var(--secondary-purple);"></i>
            <div class="value" id="card-destinos">156</div>
            <div class="label">Destinos</div>
          </div>
        </div>

        <!-- Gráficos -->
        <div class="dashboard-grid">
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Top Destinos com Mais Voos</h4>
            </div>
            <div class="chart-wrapper">
              <div id="chart-destinos" style="height:100%; width:100%;"></div>
            </div>
          </div>
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Horas Voadas por Mês</h4>
            </div>
            <div class="chart-wrapper">
              <div id="chart-horas" style="height:100%; width:100%;"></div>
            </div>
          </div>
        </div>

        <!-- Tabela -->
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Detalhamento de Voos</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="current-year-indicator">
                <i class="fas fa-calendar-alt"></i> Dados do ano: <span id="table-year">2024</span>
              </span>
              <span class="table-badge" id="voos-count">1.248 voos</span>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th onclick="sortTable('voos', 'data')">
                    Data <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('voos', 'origem')">
                    Origem <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('voos', 'destino')">
                    Destino <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('voos', 'orgao')">
                    Órgão <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('voos', 'passageiro')">
                    Passageiro <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('voos', 'horas')">
                    Horas <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('voos', 'status')">
                    Status <span class="sort-icon">▼</span>
                  </th>
                </tr>
              </thead>
              <tbody id="voos-table-body">
                <!-- Dados carregados via JavaScript -->
              </tbody>
              <tfoot id="voos-table-footer">
                <!-- Rodapé carregado via JavaScript -->
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- ABA 2: DESTINOS -->
      <div class="tab-pane fade" id="destinos" role="tabpanel">
        <!-- Filtros -->
        <div class="filter-container">
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="destinos-ano" class="form-label filter-label">Ano</label>
                <select class="form-select" id="destinos-ano">
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                  <option value="all">Todos os anos</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="destinos-destino" class="form-label filter-label">Destino</label>
                <select class="form-select" id="destinos-destino">
                  <option value="all">Todos os destinos</option>
                  <option value="CNF">Belo Horizonte (CNF)</option>
                  <option value="GRU">São Paulo (GRU)</option>
                  <option value="GIG">Rio de Janeiro (GIG)</option>
                  <option value="BSB">Brasília (BSB)</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="destinos-tipo" class="form-label filter-label">Tipo de Voo</label>
                <select class="form-select" id="destinos-tipo">
                  <option value="all">Todos os tipos</option>
                  <option value="INTERNO">Interno</option>
                  <option value="EXTERNO">Externo</option>
                  <option value="INTERNACIONAL">Internacional</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="d-flex gap-3">
                <button class="btn-primary-custom" id="btn-apply-destinos">
                  <i class="fas fa-filter me-2"></i>Aplicar Filtros
                </button>
                <button class="btn-secondary-custom" id="btn-clear-destinos">
                  <i class="fas fa-redo me-2"></i>Limpar Filtros
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Ações -->
        <div class="actions-container">
          <div class="export-buttons">
            <button class="btn-export" id="exportCSV-destinos">
              <i class="fas fa-file-csv"></i> CSV
            </button>
            <button class="btn-export" id="exportExcel-destinos">
              <i class="fas fa-file-excel"></i> Excel
            </button>
            <button class="btn-export" id="exportPDF-destinos">
              <i class="fas fa-file-pdf"></i> PDF
            </button>
            <button class="btn-export" id="btn-print-destinos">
              <i class="fas fa-print"></i> Imprimir
            </button>
          </div>
          
          <div class="social-share">
            <span class="social-share-label">Compartilhar:</span>
            <a href="#" class="btn-social btn-facebook" style="background: #3b5998;">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="btn-social btn-twitter" style="background: #1da1f2;">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="btn-social btn-linkedin" style="background: #0077b5;">
              <i class="fab fa-linkedin-in"></i>
            </a>
            <a href="#" class="btn-social btn-whatsapp" style="background: #25d366;">
              <i class="fab fa-whatsapp"></i>
            </a>
          </div>
        </div>

        <!-- Gráficos -->
        <div class="dashboard-grid">
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Distribuição por Tipo de Voo</h4>
            </div>
            <div class="chart-wrapper">
              <div id="chart-tipo-voo" style="height:100%; width:100%;"></div>
            </div>
          </div>
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Top 10 Destinos com Mais Voos</h4>
            </div>
            <div class="chart-wrapper">
              <div id="chart-top-destinos" style="height:100%; width:100%;"></div>
            </div>
          </div>
        </div>

        <!-- Tabela -->
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Análise de Destinos</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="current-year-indicator">
                <i class="fas fa-calendar-alt"></i> Período: <span id="destinos-period">2024</span>
              </span>
              <span class="table-badge" id="destinos-count">156 destinos</span>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th onclick="sortTable('destinos', 'destino')">
                    Destino <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('destinos', 'tipo')">
                    Tipo de Voo <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('destinos', 'quantidade')">
                    Quantidade <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('destinos', 'horas_totais')">
                    Horas Totais <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('destinos', 'passageiros')">
                    Passageiros <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('destinos', 'custo_medio')">
                    Custo Médio <span class="sort-icon">▼</span>
                  </th>
                </tr>
              </thead>
              <tbody id="destinos-table-body">
                <!-- Dados carregados via JavaScript -->
              </tbody>
              <tfoot id="destinos-table-footer">
                <!-- Rodapé carregado via JavaScript -->
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- ABA 3: DOWNLOAD DE DADOS -->
      <div class="tab-pane fade" id="download" role="tabpanel">
        <!-- Filtros para Download -->
        <div class="filter-container">
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="download-year" class="form-label filter-label">Ano</label>
                <select class="form-select" id="download-year">
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                  <option value="all">Todos os anos (consolidado)</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="download-format" class="form-label filter-label">Formato</label>
                <select class="form-select" id="download-format">
                  <option value="csv">CSV</option>
                  <option value="xlsx">Excel</option>
                  <option value="json">JSON</option>
                  <option value="pdf">PDF</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="download-filter" class="form-label filter-label">Com Filtros Ativos?</label>
                <select class="form-select" id="download-filter">
                  <option value="no">Sem filtros - dados completos</option>
                  <option value="yes">Com filtros aplicados</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="d-flex gap-3">
                <button class="btn-primary-custom" id="btn-download-year">
                  <i class="fas fa-download me-2"></i>Baixar Dados
                </button>
                <a href="https://dados.mg.gov.br" target="_blank" class="btn-secondary-custom">
                  <i class="fas fa-external-link-alt me-2"></i>Acessar Portal de Dados Abertos
                </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Informações sobre os dados -->
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Dados de Voos Oficiais</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="table-badge">Dados Abertos</span>
            </div>
          </div>
          <div class="p-4">
            <div class="row">
              <div class="col-md-6">
                <div class="card-stats">
                  <i class="fas fa-file-csv fa-3x mb-3" style="color: var(--secondary-green);"></i>
                  <h4>Dados Completos</h4>
                  <p class="text-muted">Baixe os dados completos de voos oficiais em formato estruturado para análise.</p>
                  <div class="mt-3">
                    <button class="btn-export w-100" onclick="downloadFullDataset()">
                      <i class="fas fa-database me-2"></i>Dataset Completo
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card-stats">
                  <i class="fas fa-code fa-3x mb-3" style="color: var(--primary-dark);"></i>
                  <h4>API de Dados</h4>
                  <p class="text-muted">Acesse os dados via API para integração com outros sistemas.</p>
                  <div class="mt-3">
                    <a href="https://dados.mg.gov.br/api" target="_blank" class="btn-export w-100 d-block text-decoration-none">
                      <i class="fas fa-code me-2"></i>Acessar API
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h5 class="mb-3">Últimas Atualizações</h5>
              <div class="list-group">
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Dados de 2024</h6>
                    <small>Atualizado em 15/01/2024</small>
                  </div>
                  <p class="mb-1">Dataset completo com todos os voos realizados em 2024.</p>
                  <small>1.248 registros, 156 destinos</small>
                </div>
                <div class="list-group-item">
                  <div class="d-flex w-100 justify-content-between">
                    <h6 class="mb-1">Dados de 2023</h6>
                    <small>Atualizado em 15/01/2023</small>
                  </div>
                  <p class="mb-1">Dataset completo com todos os voos realizados em 2023.</p>
                  <small>1.120 registros, 142 destinos</small>
                </div>
              </div>
            </div>

            <div class="mt-4">
              <h5 class="mb-3">Metadados</h5>
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Campo</th>
                    <th>Descrição</th>
                    <th>Tipo</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>data</td>
                    <td>Data do voo</td>
                    <td>Data</td>
                  </tr>
                  <tr>
                    <td>origem</td>
                    <td>Aeroporto de origem</td>
                    <td>Texto</td>
                  </tr>
                  <tr>
                    <td>destino</td>
                    <td>Aeroporto de destino</td>
                    <td>Texto</td>
                  </tr>
                  <tr>
                    <td>orgao</td>
                    <td>Órgão responsável</td>
                    <td>Texto</td>
                  </tr>
                  <tr>
                    <td>passageiro</td>
                    <td>Nome do passageiro</td>
                    <td>Texto</td>
                  </tr>
                  <tr>
                    <td>horas</td>
                    <td>Horas de voo</td>
                    <td>Decimal</td>
                  </tr>
                  <tr>
                    <td>status</td>
                    <td>Situação do voo</td>
                    <td>Texto</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ABA 4: RELATÓRIOS -->
      <div class="tab-pane fade" id="relatorios" role="tabpanel">
        <!-- Filtros para Relatórios -->
        <div class="filter-container">
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="relatorio-ano" class="form-label filter-label">Ano do Relatório</label>
                <select class="form-select" id="relatorio-ano">
                  <option value="2024">2024 (Padrão)</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="custom">Personalizado</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="relatorio-tipo" class="form-label filter-label">Tipo de Relatório</label>
                <select class="form-select" id="relatorio-tipo">
                  <option value="consolidado">Consolidado Anual</option>
                  <option value="orgaos">Por Órgão</option>
                  <option value="destinos">Por Destino</option>
                  <option value="eficiencia">Indicadores de Eficiência</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="relatorio-orgao" class="form-label filter-label">Órgão (opcional)</label>
                <select class="form-select" id="relatorio-orgao">
                  <option value="all">Todos os órgãos</option>
                  <option value="Secretaria Saúde">Secretaria de Saúde</option>
                  <option value="Secretaria Educação">Secretaria de Educação</option>
                  <option value="Secretaria Infraestrutura">Secretaria de Infraestrutura</option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="d-flex gap-3">
                <button class="btn-primary-custom" id="btn-gerar-relatorio">
                  <i class="fas fa-chart-bar me-2"></i>Gerar Relatório
                </button>
                <button class="btn-secondary-custom" id="btn-export-relatorio">
                  <i class="fas fa-file-pdf me-2"></i>Exportar PDF
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Cards de Estatísticas do Relatório -->
        <div class="card-stats-grid">
          <div class="card-stats">
            <i class="fas fa-plane fa-2x" style="color: var(--accent-red);"></i>
            <div class="value" id="relatorio-voos">1.248</div>
            <div class="label">Total de Voos</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-money-bill-wave fa-2x" style="color: var(--secondary-green);"></i>
            <div class="value" id="relatorio-custo">R$ 4,2M</div>
            <div class="label">Custo Estimado</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-users fa-2x" style="color: var(--secondary-blue);"></i>
            <div class="value" id="relatorio-media">3,1</div>
            <div class="label">Passageiros/Voo</div>
          </div>
          <div class="card-stats">
            <i class="fas fa-chart-line fa-2x" style="color: var(--secondary-purple);"></i>
            <div class="value" id="relatorio-efficiency">78%</div>
            <div class="label">Taxa de Ocupação</div>
          </div>
        </div>

        <!-- Gráficos do Relatório -->
        <div class="dashboard-grid">
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Top 10 Órgãos com Mais Voos</h4>
            </div>
            <div class="chart-wrapper">
              <div id="chart-orgaos" style="height:100%; width:100%;"></div>
            </div>
          </div>
          <div class="chart-container">
            <div class="chart-header">
              <h4 class="chart-title">Distribuição por Situação</h4>
            </div>
            <div class="chart-wrapper">
              <div id="chart-situacao" style="height:100%; width:100%;"></div>
            </div>
          </div>
        </div>

        <!-- Tabela do Relatório -->
        <div class="table-container">
          <div class="table-header">
            <h3 class="table-title">Detalhamento do Relatório</h3>
            <div class="d-flex align-items-center gap-3">
              <span class="current-year-indicator">
                <i class="fas fa-calendar-alt"></i> Período: <span id="relatorios-period">2024</span>
              </span>
              <span class="table-badge" id="relatorio-count">1.248 voos</span>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th onclick="sortTable('relatorio', 'mes')">
                    Mês <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('relatorio', 'voos_realizados')">
                    Voos Realizados <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('relatorio', 'voos_cancelados')">
                    Voos Cancelados <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('relatorio', 'horas_voadas')">
                    Horas Voadas <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('relatorio', 'passageiros')">
                    Passageiros <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('relatorio', 'custo_total')">
                    Custo Total <span class="sort-icon">▼</span>
                  </th>
                  <th onclick="sortTable('relatorio', 'eficiencia')">
                    Eficiência <span class="sort-icon">▼</span>
                  </th>
                </tr>
              </thead>
              <tbody id="relatorio-table-body">
                <!-- Dados carregados via JavaScript -->
              </tbody>
              <tfoot id="relatorio-table-footer">
                <!-- Rodapé carregado via JavaScript -->
              </tfoot>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <p><i class="fas fa-database"></i> Dados abertos — atualizados via repositório GitHub.</p>
      <p style="margin-top: 10px; font-size: 0.8rem;">
        © 2024 Governo de Minas Gerais. 
        <a href="https://dados.mg.gov.br" style="color: var(--primary-dark); text-decoration: none; font-weight: 600;">
          <i class="fas fa-external-link-alt"></i> dados.mg.gov.br
        </a>
      </p>
    </div>
  </footer>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // ============================================
    // CONFIGURAÇÃO INICIAL
    // ============================================
    
    const chartInstances = {};
    let sortStates = {
      voos: { column: 'data', direction: 'desc' },
      destinos: { column: 'quantidade', direction: 'desc' },
      relatorio: { column: 'mes', direction: 'asc' }
    };
    
    // Paleta de cores (mesma do diarias_viagens.html)
    const palette = {
      primary: ['#29435A', '#2E5984', '#3A7CA5', '#4F9EC4'],
      accent: ['#B93C42', '#DB233F', '#E5586E', '#EF8A9E'],
      secondary: ['#2E8B57', '#3CB371', '#66CDAA', '#98F5FF'],
      additional: ['#6A5ACD', '#9370DB', '#BA55D3', '#DA70D6']
    };
    
    // Dados mockados para voos
    const dadosVoos = [
      { data: '15/03/2024', origem: 'Belo Horizonte (CNF)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Saúde', passageiro: 'João Silva', horas: 1.5, status: 'REALIZADO' },
      { data: '18/03/2024', origem: 'Belo Horizonte (CNF)', destino: 'Rio de Janeiro (GIG)', orgao: 'Secretaria de Educação', passageiro: 'Maria Oliveira', horas: 1.2, status: 'REALIZADO' },
      { data: '22/03/2024', origem: 'Uberlândia (UDI)', destino: 'Brasília (BSB)', orgao: 'Secretaria de Infraestrutura', passageiro: 'Carlos Santos', horas: 2.0, status: 'CANCELADA' },
      { data: '10/02/2024', origem: 'Belo Horizonte (CNF)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Saúde', passageiro: 'Ana Costa', horas: 1.5, status: 'REALIZADO' },
      { data: '05/04/2024', origem: 'Belo Horizonte (CNF)', destino: 'Uberlândia (UDI)', orgao: 'Secretaria de Segurança', passageiro: 'Roberto Alves', horas: 0.8, status: 'REALIZADO' },
      { data: '12/04/2024', origem: 'São Paulo (GRU)', destino: 'Brasília (BSB)', orgao: 'Governadoria', passageiro: 'Patrícia Lima', horas: 1.8, status: 'REALIZADO' },
      { data: '20/04/2024', origem: 'Rio de Janeiro (GIG)', destino: 'Belo Horizonte (CNF)', orgao: 'Secretaria de Cultura', passageiro: 'Fernando Souza', horas: 1.3, status: 'CANCELADA' },
      { data: '25/04/2024', origem: 'Brasília (BSB)', destino: 'São Paulo (GRU)', orgao: 'Secretaria de Finanças', passageiro: 'Amanda Rocha', horas: 2.1, status: 'REALIZADO' }
    ];
    
    // Dados mockados para destinos
    const dadosDestinos = [
      { destino: 'São Paulo (GRU)', tipo: 'Externo', quantidade: 280, horas_totais: 420, passageiros: 850, custo_medio: 2450 },
      { destino: 'Rio de Janeiro (GIG)', tipo: 'Externo', quantidade: 195, horas_totais: 292, passageiros: 580, custo_medio: 1980 },
      { destino: 'Brasília (BSB)', tipo: 'Interno', quantidade: 150, horas_totais: 300, passageiros: 450, custo_medio: 3120 },
      { destino: 'Uberlândia (UDI)', tipo: 'Interno', quantidade: 120, horas_totais: 180, passageiros: 360, custo_medio: 1750 },
      { destino: 'Vitória (VIX)', tipo: 'Externo', quantidade: 85, horas_totais: 127, passageiros: 255, custo_medio: 2100 },
      { destino: 'Curitiba (CWB)', tipo: 'Externo', quantidade: 75, horas_totais: 112, passageiros: 225, custo_medio: 2300 }
    ];
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
      setupEventListeners();
      setupTooltips();
      loadInitialData();
    });
    
    function setupEventListeners() {
      // Visão Geral
      document.getElementById('btn-apply').addEventListener('click', loadVoosData);
      document.getElementById('btn-clear').addEventListener('click', clearVoosFilters);
      
      // Destinos
      document.getElementById('btn-apply-destinos').addEventListener('click', loadDestinosData);
      document.getElementById('btn-clear-destinos').addEventListener('click', clearDestinosFilters);
      
      // Relatórios
      document.getElementById('btn-gerar-relatorio').addEventListener('click', loadRelatorioData);
      
      // Exportação
      document.getElementById('exportCSV').addEventListener('click', () => exportData('voos'));
      document.getElementById('exportCSV-destinos').addEventListener('click', () => exportData('destinos'));
      
      // Download
      document.getElementById('btn-download-year').addEventListener('click', handleDownload);
      
      // Impressão
      document.getElementById('btn-print').addEventListener('click', () => printCurrentTab('Visão Geral de Voos'));
      document.getElementById('btn-print-destinos').addEventListener('click', () => printCurrentTab('Análise de Destinos'));
      document.getElementById('btn-export-relatorio').addEventListener('click', () => printCurrentTab('Relatório de Voos'));
      
      // Compartilhamento em redes sociais
      setupSocialShare();
    }
    
    function setupTooltips() {
      // Tooltips para filtros
      tippy('#filter-ano', {
        content: 'Selecione o ano para filtrar os dados',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      tippy('#filter-origem', {
        content: 'Selecione o aeroporto de origem',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      tippy('#filter-destino', {
        content: 'Selecione o aeroporto de destino',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      tippy('#filter-situacao', {
        content: 'Filtre por situação do voo',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      // Tooltips para botões
      tippy('.btn-export', {
        content: 'Exportar dados',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      tippy('.btn-social', {
        content: 'Compartilhar',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
      
      tippy('.sort-icon', {
        content: 'Clique para ordenar',
        placement: 'top',
        theme: 'light',
        animation: 'scale'
      });
    }
    
    function setupSocialShare() {
      document.querySelectorAll('.btn-social').forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          
          const url = encodeURIComponent(window.location.href);
          const title = encodeURIComponent('Painel de Voos Oficiais - Governo de Minas Gerais');
          const text = encodeURIComponent('Confira os dados de transparência sobre voos oficiais do Governo de Minas Gerais');
          
          let shareUrl = '';
          
          if (this.classList.contains('btn-facebook')) {
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
          } else if (this.classList.contains('btn-twitter')) {
            shareUrl = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
          } else if (this.classList.contains('btn-linkedin')) {
            shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
          } else if (this.classList.contains('btn-whatsapp')) {
            shareUrl = `https://wa.me/?text=${text}%20${url}`;
          }
          
          if (shareUrl) {
            window.open(shareUrl, '_blank', 'width=600,height=400');
          }
        });
      });
    }
    
    function loadInitialData() {
      loadVoosData();
      loadDestinosData();
      loadRelatorioData();
      
      // Atualiza indicador de ano atual
      document.getElementById('table-year').textContent = '2024';
      document.getElementById('destinos-period').textContent = '2024';
      document.getElementById('relatorios-period').textContent = '2024';
    }
    
    // ============================================
    // FUNÇÕES DE FORMATAÇÃO
    // ============================================
    
    function formatCurrency(valor) {
      return new Intl.NumberFormat('pt-BR', { 
        style: 'currency', 
        currency: 'BRL',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(valor);
    }
    
    function formatHoras(horas) {
      const horasInt = Math.floor(horas);
      const minutos = Math.round((horas - horasInt) * 60);
      return `${horasInt}h${minutos > 0 ? ` ${minutos}m` : ''}`;
    }
    
    // ============================================
    // SISTEMA DE ORDENAÇÃO
    // ============================================
    
    function sortTable(tableType, column) {
      const currentSort = sortStates[tableType];
      
      // Alternar direção se clicar na mesma coluna
      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
      }
      
      // Atualizar ícones
      updateSortIcons(tableType, column, currentSort.direction);
      
      // Aplicar ordenação
      switch(tableType) {
        case 'voos':
          sortVoosData(column, currentSort.direction);
          break;
        case 'destinos':
          sortDestinosData(column, currentSort.direction);
          break;
        case 'relatorio':
          sortRelatorioData(column, currentSort.direction);
          break;
      }
    }
    
    function updateSortIcons(tableType, column, direction) {
      // Resetar todos os ícones da tabela
      const table = document.querySelector(`#${tableType}-table-body`).closest('table');
      const headers = table.querySelectorAll('thead th');
      
      headers.forEach(header => {
        header.classList.remove('sorted-asc', 'sorted-desc');
        const icon = header.querySelector('.sort-icon');
        if (icon) {
          icon.textContent = '▼';
        }
      });
      
      // Atualizar o cabeçalho atual
      const currentHeader = Array.from(headers).find(th => 
        th.getAttribute('onclick')?.includes(column)
      );
      
      if (currentHeader) {
        currentHeader.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
        const icon = currentHeader.querySelector('.sort-icon');
        if (icon) {
          icon.textContent = direction === 'asc' ? '▲' : '▼';
        }
      }
    }
    
    // ============================================
    // VISÃO GERAL (VOOS)
    // ============================================
    
    function loadVoosData() {
      const ano = document.getElementById('filter-ano').value;
      const origem = document.getElementById('filter-origem').value;
      const destino = document.getElementById('filter-destino').value;
      const situacao = document.getElementById('filter-situacao').value;
      
      let filteredData = [...dadosVoos];
      
      if (ano !== 'all') {
        // Filtrar por ano (simplificado)
        filteredData = filteredData.filter(v => v.data.includes('/2024'));
      }
      
      if (origem !== 'all') {
        filteredData = filteredData.filter(v => v.origem.includes(origem));
      }
      
      if (destino !== 'all') {
        filteredData = filteredData.filter(v => v.destino.includes(destino));
      }
      
      if (situacao !== 'all') {
        filteredData = filteredData.filter(v => v.status === situacao);
      }
      
      // Ordenar por data (decrescente por padrão)
      filteredData.sort((a, b) => {
        const aDate = a.data.split('/').reverse().join('');
        const bDate = b.data.split('/').reverse().join('');
        return bDate.localeCompare(aDate);
      });
      
      renderVoosTable(filteredData);
      renderVoosCharts(filteredData);
      updateVoosStatistics(filteredData);
      
      // Atualizar ícones de ordenação
      updateSortIcons('voos', 'data', 'desc');
      
      // Atualizar contador
      document.getElementById('voos-count').textContent = `${filteredData.length} voos`;
      
      // Atualizar ano na tabela
      document.getElementById('table-year').textContent = ano === 'all' ? 'Todos' : ano;
    }
    
    function renderVoosTable(data) {
      const tableBody = document.getElementById('voos-table-body');
      const tableFooter = document.getElementById('voos-table-footer');
      
      let tableHTML = '';
      let totalHoras = 0;
      
      data.forEach(item => {
        tableHTML += `
          <tr>
            <td>${item.data}</td>
            <td>${item.origem}</td>
            <td>${item.destino}</td>
            <td>${item.orgao}</td>
            <td>${item.passageiro}</td>
            <td>${formatHoras(item.horas)}</td>
            <td>
              <span class="badge-status ${item.status === 'REALIZADO' ? 'badge-realizado' : 'badge-cancelado'}">
                <i class="fas ${item.status === 'REALIZADO' ? 'fa-check-circle' : 'fa-times-circle'}"></i>
                ${item.status}
              </span>
            </td>
          </tr>
        `;
        
        totalHoras += item.horas;
      });
      
      tableBody.innerHTML = tableHTML || '<tr><td colspan="7" class="text-center">Nenhum voo encontrado</td></tr>';
      tableFooter.innerHTML = `
        <tr class="table-footer">
          <td colspan="5"><strong>TOTAL</strong></td>
          <td><strong>${formatHoras(totalHoras)}</strong></td>
          <td><strong>${data.length} voos</strong></td>
        </tr>
      `;
    }
    
    function renderVoosCharts(data) {
      // Gráfico de destinos
      const destinosCount = {};
      data.forEach(item => {
        const destino = item.destino.split(' (')[0];
        destinosCount[destino] = (destinosCount[destino] || 0) + 1;
      });
      
      const destinosArray = Object.entries(destinosCount)
        .map(([destino, quantidade]) => ({ destino, quantidade }))
        .sort((a, b) => b.quantidade - a.quantidade)
        .slice(0, 8);
      
      const destinosTrace = {
        x: destinosArray.map(d => d.destino.length > 10 ? d.destino.substring(0, 10) + '...' : d.destino),
        y: destinosArray.map(d => d.quantidade),
        type: 'bar',
        marker: { color: palette.primary[0] }
      };
      
      Plotly.newPlot('chart-destinos', [destinosTrace], {
        title: '',
        margin: { t: 10, r: 30, b: 80, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Gráfico de horas por mês
      const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
      const horasMensais = meses.map(() => Math.random() * 30 + 180);
      
      const horasTrace = {
        x: meses,
        y: horasMensais,
        type: 'scatter',
        mode: 'lines+markers',
        line: { color: palette.secondary[0], width: 3 },
        marker: { color: palette.secondary[0], size: 8 }
      };
      
      Plotly.newPlot('chart-horas', [horasTrace], {
        title: '',
        margin: { t: 10, r: 30, b: 50, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
    }
    
    function updateVoosStatistics(data) {
      const totalVoos = data.length;
      const totalHoras = data.reduce((sum, item) => sum + item.horas, 0);
      const totalPassageiros = totalVoos * 3.1; // Estimativa
      const destinosUnicos = new Set(data.map(item => item.destino)).size;
      
      document.getElementById('card-voos').textContent = totalVoos.toLocaleString('pt-BR');
      document.getElementById('card-horas').textContent = formatHoras(totalHoras);
      document.getElementById('card-pass').textContent = Math.round(totalPassageiros).toLocaleString('pt-BR');
      document.getElementById('card-destinos').textContent = destinosUnicos;
    }
    
    function sortVoosData(column, direction) {
      let sortedData = [...dadosVoos];
      
      sortedData.sort((a, b) => {
        let valA = a[column];
        let valB = b[column];
        
        if (column === 'data') {
          // Converte datas para comparação
          const aDate = valA.split('/').reverse().join('');
          const bDate = valB.split('/').reverse().join('');
          return direction === 'asc' ? aDate.localeCompare(bDate) : bDate.localeCompare(aDate);
        } else if (column === 'horas') {
          return direction === 'asc' ? valA - valB : valB - valA;
        } else {
          // Ordenação alfabética para outras colunas
          return direction === 'asc' ? 
            valA.localeCompare(valB, 'pt-BR') : 
            valB.localeCompare(valA, 'pt-BR');
        }
      });
      
      renderVoosTable(sortedData);
    }
    
    function clearVoosFilters() {
      document.getElementById('filter-ano').value = '2024';
      document.getElementById('filter-origem').value = 'all';
      document.getElementById('filter-destino').value = 'all';
      document.getElementById('filter-situacao').value = 'all';
      loadVoosData();
    }
    
    // ============================================
    // DESTINOS
    // ============================================
    
    function loadDestinosData() {
      const ano = document.getElementById('destinos-ano').value;
      const destino = document.getElementById('destinos-destino').value;
      const tipo = document.getElementById('destinos-tipo').value;
      
      let filteredData = [...dadosDestinos];
      
      if (destino !== 'all') {
        filteredData = filteredData.filter(d => d.destino.includes(destino));
      }
      
      if (tipo !== 'all') {
        filteredData = filteredData.filter(d => d.tipo === tipo);
      }
      
      // Ordenar por quantidade (decrescente por padrão)
      filteredData.sort((a, b) => b.quantidade - a.quantidade);
      
      renderDestinosTable(filteredData);
      renderDestinosCharts(filteredData);
      
      // Atualizar ícones de ordenação
      updateSortIcons('destinos', 'quantidade', 'desc');
      
      // Atualizar contador
      document.getElementById('destinos-count').textContent = `${filteredData.length} destinos`;
      
      // Atualizar período
      document.getElementById('destinos-period').textContent = ano === 'all' ? 'Todos' : ano;
    }
    
    function renderDestinosTable(data) {
      const tableBody = document.getElementById('destinos-table-body');
      const tableFooter = document.getElementById('destinos-table-footer');
      
      let tableHTML = '';
      let totals = { quantidade: 0, horas_totais: 0, passageiros: 0 };
      
      data.forEach(item => {
        tableHTML += `
          <tr>
            <td>${item.destino}</td>
            <td>${item.tipo}</td>
            <td>${item.quantidade.toLocaleString('pt-BR')}</td>
            <td>${formatHoras(item.horas_totais)}</td>
            <td>${item.passageiros.toLocaleString('pt-BR')}</td>
            <td>${formatCurrency(item.custo_medio)}</td>
          </tr>
        `;
        
        totals.quantidade += item.quantidade;
        totals.horas_totais += item.horas_totais;
        totals.passageiros += item.passageiros;
      });
      
      tableBody.innerHTML = tableHTML || '<tr><td colspan="6" class="text-center">Nenhum destino encontrado</td></tr>';
      tableFooter.innerHTML = `
        <tr class="table-footer">
          <td colspan="2"><strong>TOTAL</strong></td>
          <td><strong>${totals.quantidade.toLocaleString('pt-BR')}</strong></td>
          <td><strong>${formatHoras(totals.horas_totais)}</strong></td>
          <td><strong>${totals.passageiros.toLocaleString('pt-BR')}</strong></td>
          <td><strong>—</strong></td>
        </tr>
      `;
    }
    
    function renderDestinosCharts(data) {
      // Gráfico de tipo de voo
      const tiposCount = {};
      data.forEach(item => {
        tiposCount[item.tipo] = (tiposCount[item.tipo] || 0) + 1;
      });
      
      const tiposTrace = {
        labels: Object.keys(tiposCount),
        values: Object.values(tiposCount),
        type: 'pie',
        marker: { colors: [palette.primary[0], palette.accent[0], palette.secondary[0]] }
      };
      
      Plotly.newPlot('chart-tipo-voo', [tiposTrace], {
        title: '',
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Gráfico de top destinos
      const topDestinos = [...data]
        .sort((a, b) => b.quantidade - a.quantidade)
        .slice(0, 8);
      
      const topDestinosTrace = {
        x: topDestinos.map(d => d.destino.split(' (')[0]),
        y: topDestinos.map(d => d.quantidade),
        type: 'bar',
        marker: { color: palette.accent[0] }
      };
      
      Plotly.newPlot('chart-top-destinos', [topDestinosTrace], {
        title: '',
        margin: { t: 10, r: 30, b: 80, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
    }
    
    function sortDestinosData(column, direction) {
      let sortedData = [...dadosDestinos];
      
      sortedData.sort((a, b) => {
        let valA = a[column];
        let valB = b[column];
        
        if (typeof valA === 'string') {
          return direction === 'asc' ? 
            valA.localeCompare(valB, 'pt-BR') : 
            valB.localeCompare(valA, 'pt-BR');
        } else {
          return direction === 'asc' ? valA - valB : valB - valA;
        }
      });
      
      renderDestinosTable(sortedData);
    }
    
    function clearDestinosFilters() {
      document.getElementById('destinos-ano').value = '2024';
      document.getElementById('destinos-destino').value = 'all';
      document.getElementById('destinos-tipo').value = 'all';
      loadDestinosData();
    }
    
    // ============================================
    // RELATÓRIOS
    // ============================================
    
    function loadRelatorioData() {
      const ano = document.getElementById('relatorio-ano').value;
      const tipo = document.getElementById('relatorio-tipo').value;
      
      renderRelatorioTable();
      renderRelatorioCharts();
      
      // Atualizar período
      document.getElementById('relatorios-period').textContent = ano === 'all' ? 'Todos' : ano;
      document.getElementById('relatorio-count').textContent = '1.248 voos';
    }
    
    function renderRelatorioTable() {
      const tableBody = document.getElementById('relatorio-table-body');
      const tableFooter = document.getElementById('relatorio-table-footer');
      
      const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
      
      let tableHTML = '';
      let totals = { voos_realizados: 0, voos_cancelados: 0, horas_voadas: 0, passageiros: 0, custo_total: 0 };
      
      meses.forEach((mes, index) => {
        const voosRealizados = Math.floor(Math.random() * 30) + 90;
        const voosCancelados = Math.floor(Math.random() * 5) + 1;
        const horasVoadas = Math.floor(Math.random() * 50) + 180;
        const passageiros = Math.floor(Math.random() * 150) + 250;
        const custoTotal = (Math.random() * 50 + 200) * 1000;
        const eficiencia = Math.floor(Math.random() * 20) + 70;
        
        tableHTML += `
          <tr>
            <td>${mes}</td>
            <td>${voosRealizados.toLocaleString('pt-BR')}</td>
            <td>${voosCancelados.toLocaleString('pt-BR')}</td>
            <td>${formatHoras(horasVoadas)}</td>
            <td>${passageiros.toLocaleString('pt-BR')}</td>
            <td>${formatCurrency(custoTotal)}</td>
            <td>${eficiencia}%</td>
          </tr>
        `;
        
        totals.voos_realizados += voosRealizados;
        totals.voos_cancelados += voosCancelados;
        totals.horas_voadas += horasVoadas;
        totals.passageiros += passageiros;
        totals.custo_total += custoTotal;
      });
      
      tableBody.innerHTML = tableHTML;
      tableFooter.innerHTML = `
        <tr class="table-footer">
          <td><strong>TOTAL</strong></td>
          <td><strong>${totals.voos_realizados.toLocaleString('pt-BR')}</strong></td>
          <td><strong>${totals.voos_cancelados.toLocaleString('pt-BR')}</strong></td>
          <td><strong>${formatHoras(totals.horas_voadas)}</strong></td>
          <td><strong>${totals.passageiros.toLocaleString('pt-BR')}</strong></td>
          <td><strong>${formatCurrency(totals.custo_total)}</strong></td>
          <td><strong>${Math.round((totals.passageiros / (totals.voos_realizados * 4)) * 100)}%</strong></td>
        </tr>
      `;
    }
    
    function renderRelatorioCharts() {
      // Gráfico de órgãos
      const orgaosTrace = {
        x: ['Secretaria Saúde', 'Secretaria Educação', 'Secretaria Infraestrutura', 'Governadoria', 'Secretaria Segurança', 'Outros'],
        y: [320, 280, 195, 150, 120, 183],
        type: 'bar',
        marker: { color: palette.primary[0] }
      };
      
      Plotly.newPlot('chart-orgaos', [orgaosTrace], {
        title: '',
        margin: { t: 10, r: 30, b: 80, l: 60 },
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
      
      // Gráfico de situação
      const situacaoTrace = {
        labels: ['Realizados', 'Cancelados'],
        values: [1150, 98],
        type: 'pie',
        marker: { colors: [palette.secondary[0], palette.accent[0]] }
      };
      
      Plotly.newPlot('chart-situacao', [situacaoTrace], {
        title: '',
        paper_bgcolor: 'transparent',
        plot_bgcolor: 'transparent'
      });
    }
    
    function sortRelatorioData(column, direction) {
      // Implementação simplificada
      const tableBody = document.getElementById('relatorio-table-body');
      const rows = Array.from(tableBody.querySelectorAll('tr'));
      
      rows.sort((a, b) => {
        const aVal = a.cells[0].textContent;
        const bVal = b.cells[0].textContent;
        
        if (column === 'mes') {
          const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
          const aIndex = meses.indexOf(aVal);
          const bIndex = meses.indexOf(bVal);
          return direction === 'asc' ? aIndex - bIndex : bIndex - aIndex;
        }
        
        return 0;
      });
      
      // Reordenar as linhas na tabela
      rows.forEach(row => tableBody.appendChild(row));
    }
    
    // ============================================
    // FUNÇÕES DE EXPORTAÇÃO E DOWNLOAD
    // ============================================
    
    function exportData(tipo) {
      let data, filename, headers;
      
      switch(tipo) {
        case 'voos':
          data = dadosVoos;
          filename = `voos_oficiais_${new Date().toISOString().slice(0,10)}.csv`;
          headers = ['Data', 'Origem', 'Destino', 'Órgão', 'Passageiro', 'Horas', 'Status'];
          break;
          
        case 'destinos':
          data = dadosDestinos;
          filename = `analise_destinos_${new Date().toISOString().slice(0,10)}.csv`;
          headers = ['Destino', 'Tipo de Voo', 'Quantidade', 'Horas Totais', 'Passageiros', 'Custo Médio'];
          break;
      }
      
      exportToCSV(data, filename, headers);
      showNotification('Dados exportados com sucesso!', 'success');
    }
    
    function exportToCSV(data, filename, headers) {
      const csvRows = [];
      csvRows.push(headers.join(','));
      
      data.forEach(item => {
        const row = headers.map(header => {
          const key = header.toLowerCase().replace(' ', '_').normalize('NFD').replace(/[\u0300-\u036f]/g, '');
          const value = item[key] || item[header] || '';
          
          // Escapar vírgulas em strings
          if (typeof value === 'string' && value.includes(',')) {
            return `"${value}"`;
          }
          
          return value;
        });
        csvRows.push(row.join(','));
      });
      
      const csvContent = csvRows.join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', filename);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    function handleDownload() {
      const ano = document.getElementById('download-year').value;
      const formato = document.getElementById('download-format').value;
      const filtro = document.getElementById('download-filter').value;
      
      // Simular processamento
      showLoading();
      
      setTimeout(() => {
        hideLoading();
        
        let filename = `voos_oficiais_${ano}`;
        if (filtro === 'yes') {
          filename += '_com_filtros';
        }
        
        switch(formato) {
          case 'csv':
            filename += '.csv';
            break;
          case 'xlsx':
            filename += '.xlsx';
            break;
          case 'json':
            filename += '.json';
            break;
          case 'pdf':
            filename += '.pdf';
            break;
        }
        
        showNotification(`Download do arquivo ${filename} iniciado!`, 'success');
      }, 1500);
    }
    
    function downloadFullDataset() {
      showLoading();
      
      setTimeout(() => {
        hideLoading();
        
        const filename = `dataset_completo_voos_oficiais_${new Date().getFullYear()}.zip`;
        showNotification(`Dataset completo baixado: ${filename}`, 'success');
      }, 2000);
    }
    
    // ============================================
    // FUNÇÕES DE UTILITÁRIOS
    // ============================================
    
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        min-width: 300px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      `;
      
      notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentNode) {
          notification.remove();
        }
      }, 5000);
    }
    
    function showLoading() {
      document.getElementById('loadingOverlay').style.display = 'flex';
    }
    
    function hideLoading() {
      document.getElementById('loadingOverlay').style.display = 'none';
    }
    
    function printCurrentTab(title) {
      const activeTab = document.querySelector('.tab-pane.active');
      const originalBody = document.body.innerHTML;
      
      const printContent = `
        <html>
        <head>
          <title>${title} - Governo de Minas Gerais</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              padding: 20px; 
              color: #333; 
            }
            .print-header {
              text-align: center;
              margin-bottom: 30px;
              border-bottom: 2px solid #B93C42;
              padding-bottom: 20px;
            }
            .print-title {
              color: #29435A;
              font-size: 24px;
              margin: 0;
            }
            .print-subtitle {
              color: #666;
              font-size: 14px;
              margin: 5px 0 0 0;
            }
            .print-date {
              color: #666;
              font-size: 12px;
              margin-top: 10px;
            }
            table {
              width: 100%;
              border-collapse: collapse;
              margin: 20px 0;
              font-size: 12px;
            }
            th {
              background-color: #f8f9fa;
              color: #29435A;
              font-weight: bold;
              text-transform: uppercase;
              padding: 12px 8px;
              border: 1px solid #dee2e6;
              text-align: left;
            }
            td {
              padding: 10px 8px;
              border: 1px solid #dee2e6;
            }
            .total-row {
              background-color: #f8f9fa;
              font-weight: bold;
            }
            @media print {
              .no-print { display: none; }
              .page-break { page-break-before: always; }
            }
          </style>
        </head>
        <body>
          <div class="print-header">
            <h1 class="print-title">${title}</h1>
            <p class="print-subtitle">Governo do Estado de Minas Gerais</p>
            <p class="print-subtitle">Painel de Voos Oficiais - Transparência de Voos</p>
            <p class="print-date">Data da impressão: ${new Date().toLocaleDateString('pt-BR')}</p>
          </div>
          ${activeTab.innerHTML}
        </body>
        </html>
      `;
      
      const printWindow = window.open('', '_blank');
      printWindow.document.write(printContent);
      printWindow.document.close();
      
      printWindow.onload = () => {
        setTimeout(() => {
          printWindow.print();
          printWindow.close();
        }, 500);
      };
    }
    
    // Atalhos de teclado
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'f') {
        e.preventDefault();
        const activeTab = document.querySelector('.tab-pane.active');
        const firstFilter = activeTab.querySelector('input, select');
        if (firstFilter) {
          firstFilter.focus();
        }
      }
      
      if (e.key === 'Escape') {
        const activeTabId = document.querySelector('.tab-pane.active').id;
        if (activeTabId === 'overview') {
          clearVoosFilters();
        } else if (activeTabId === 'destinos') {
          clearDestinosFilters();
        }
      }
    });
    
    console.log('Painel de Voos Oficiais carregado com sucesso!');
  </script>
</body>
</html>
