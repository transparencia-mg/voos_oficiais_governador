<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voos Oficiais - Governo do Estado de Minas Gerais</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-dark: #29435A;
            --primary-darker: #132837;
            --accent-red: #B93C42;
            --accent-bright: #DB233F;
            --background-light: #EEEFF5;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-light);
            padding-bottom: 20px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .filter-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent-red);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
            border: none;
        }
        
        .table-responsive {
            border-radius: 0 0 10px 10px;
        }
        
        .chart-container {
            position: relative;
            height: 320px;
            margin-bottom: 10px;
        }
        
        .summary-card {
            text-align: center;
            padding: 25px 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-top: 5px solid var(--accent-red);
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .summary-card h3 {
            margin: 0;
            font-size: 2.2rem;
            color: var(--primary-dark);
            font-weight: 700;
        }
        
        .summary-card p {
            margin: 8px 0 0;
            color: var(--primary-darker);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--accent-red), var(--accent-bright));
            border: none;
            padding: 10px 25px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--accent-bright), var(--accent-red));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(219, 35, 63, 0.3);
        }
        
        .btn-outline-secondary {
            border: 2px solid var(--primary-dark);
            color: var(--primary-dark);
            padding: 10px 25px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .btn-outline-secondary:hover {
            background-color: var(--primary-dark);
            color: white;
            transform: translateY(-2px);
        }
        
        .table thead th {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            font-weight: 600;
            border: none;
            padding: 15px 12px;
        }
        
        .table tbody tr {
            transition: background-color 0.2s ease;
        }
        
        .table tbody tr:hover {
            background-color: rgba(41, 67, 90, 0.05);
        }
        
        .table tbody td {
            padding: 12px;
            border-color: #e9ecef;
        }
        
        h1 {
            font-weight: 700;
            color: white;
        }
        
        .filter-label {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 10px 12px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--accent-red);
            box-shadow: 0 0 0 0.2rem rgba(185, 60, 66, 0.2);
        }
        
        .badge-primary {
            background-color: var(--accent-red);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: var(--accent-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-export {
            background: white;
            border: 2px solid var(--primary-dark);
            color: var(--primary-dark);
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-export:hover {
            background: var(--primary-dark);
            color: white;
            transform: translateY(-2px);
        }
        
        .social-share {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-social {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-facebook { background: #3b5998; }
        .btn-twitter { background: #1da1f2; }
        .btn-linkedin { background: #0077b5; }
        .btn-whatsapp { background: #25d366; }
        
        .btn-social:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .flight-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .time-display {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .period-filter-container {
            display: flex;
            gap: 15px;
        }
        
        .period-filter-item {
            flex: 1;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .data-info {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .export-buttons {
                width: 100%;
                justify-content: flex-start;
            }
            
            .header-subtitle {
                font-size: 1rem;
            }
            
            .period-filter-container {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
        </div>
    </div>

    <div class="dashboard-header">
        <div class="container">
            <div class="logo-container">
                <div class="logo">MG</div>
                <div>
                    <h1 class="h3 mb-1">Voos Oficiais - Governo do Estado de Minas Gerais</h1>
                    <p class="header-subtitle mb-0">Relatório de Voos de Autoridade - Dados Atualizados</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Informações dos Dados -->
        <div class="data-info" id="dataInfo">
            <i class="fas fa-info-circle"></i> 
            <span id="dataStatus">Carregando dados...</span>
            <span id="lastUpdate" class="ms-3"></span>
        </div>

        <!-- Filtros -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="ano" class="form-label filter-label">Ano</label>
                        <select class="form-select" id="ano">
                            <option value="all" selected>Todos os Anos</option>
                            <!-- Os anos serão carregados dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="mes" class="form-label filter-label">Mês</label>
                        <select class="form-select" id="mes">
                            <option value="all" selected>Todos os Meses</option>
                            <option value="1">Janeiro</option>
                            <option value="2">Fevereiro</option>
                            <option value="3">Março</option>
                            <option value="4">Abril</option>
                            <option value="5">Maio</option>
                            <option value="6">Junho</option>
                            <option value="7">Julho</option>
                            <option value="8">Agosto</option>
                            <option value="9">Setembro</option>
                            <option value="10">Outubro</option>
                            <option value="11">Novembro</option>
                            <option value="12">Dezembro</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="periodo" class="form-label filter-label">Período Específico</label>
                        <select class="form-select" id="periodo">
                            <option value="all" selected>Todos os Períodos</option>
                            <!-- Os períodos serão carregados dinamicamente -->
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="origem" class="form-label filter-label">Origem</label>
                        <select class="form-select" id="origem">
                            <option value="all" selected>Todas as Origens</option>
                            <!-- As origens serão carregadas dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="destino" class="form-label filter-label">Destino</label>
                        <select class="form-select" id="destino">
                            <option value="all" selected>Todos os Destinos</option>
                            <!-- Os destinos serão carregados dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="orgao" class="form-label filter-label">Órgão</label>
                        <select class="form-select" id="orgao">
                            <option value="all" selected>Todos os Órgãos</option>
                            <!-- Os órgãos serão carregados dinamicamente -->
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="situacao" class="form-label filter-label">Situação</label>
                        <select class="form-select" id="situacao">
                            <option value="all" selected>Todas as Situações</option>
                            <option value="REALIZADO">Realizado</option>
                            <option value="PLANEJADA">Planejada</option>
                            <option value="CANCELADA">Cancelada</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-primary me-2" id="aplicarFiltros">
                        <i class="fas fa-filter"></i> Aplicar Filtros
                    </button>
                    <button class="btn btn-outline-secondary" id="limparFiltros">
                        <i class="fas fa-redo"></i> Limpar Filtros
                    </button>
                    <button class="btn btn-outline-secondary" id="atualizarDados">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados
                    </button>
                </div>
            </div>
        </div>

        <!-- Cards de Resumo -->
        <div class="row mb-4" id="summaryCards">
            <!-- Os cards serão carregados dinamicamente -->
        </div>

        <!-- Gráficos -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Distribuição de Voos por Destino</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="destinosChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Horas Voadas por Data</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="horasChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ações de Exportação e Compartilhamento -->
        <div class="action-buttons">
            <div class="export-buttons">
                <button class="btn-export" id="exportCSV">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                </button>
                <button class="btn-export" id="exportExcel">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
                <button class="btn-export" id="exportPDF">
                    <i class="fas fa-file-pdf"></i> Exportar PDF
                </button>
                <button class="btn-export" id="printDashboard">
                    <i class="fas fa-print"></i> Imprimir
                </button>
            </div>
            
            <div class="social-share">
                <span class="me-2" style="color: var(--primary-dark); font-weight: 500;">Compartilhar:</span>
                <a href="#" class="btn-social btn-facebook" id="shareFacebook" title="Compartilhar no Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="btn-social btn-twitter" id="shareTwitter" title="Compartilhar no Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="btn-social btn-linkedin" id="shareLinkedIn" title="Compartilhar no LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="#" class="btn-social btn-whatsapp" id="shareWhatsApp" title="Compartilhar no WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>

        <!-- Tabela de Dados -->
        <div class="card mt-2">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="tableTitle">Detalhamento de Voos</h5>
                <span class="badge-primary" id="flightCount">Carregando...</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0" id="flightsTable">
                        <thead class="table-dark">
                            <tr>
                                <th>Data</th>
                                <th>Diário de Bordo</th>
                                <th>Origem → Destino</th>
                                <th>Horas Voadas</th>
                                <th>Passageiros</th>
                                <th>Aeronave</th>
                                <th>Órgão</th>
                                <th>Situação</th>
                            </tr>
                        </thead>
                        <tbody id="flightsTableBody">
                            <!-- Os dados serão carregados dinamicamente -->
                        </tbody>
                        <tfoot id="flightsTableFooter">
                            <!-- O rodapé será carregado dinamicamente -->
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tabela de Passageiros Frequentes -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0" id="passengersTitle">Principais Passageiros</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0" id="passengersTable">
                        <thead class="table-dark">
                            <tr>
                                <th>Passageiro</th>
                                <th>Cargo/Função</th>
                                <th>Órgão</th>
                                <th>Voos Participados</th>
                                <th>Total Horas Voadas</th>
                            </tr>
                        </thead>
                        <tbody id="passengersTableBody">
                            <!-- Os dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variáveis globais
        let flightData = [];
        let filteredData = [];
        let destinosChart, horasChart;
        let lastDataUpdate = null;

        // Lista de arquivos CSV por ano
        const CSV_FILES = [
            'data/voos_2026.csv',
            'data/voos_2025.csv',
            'data/voos_2024.csv',
            'data/voos_2023.csv',
            'data/voos_2022.csv',
            'data/voos_2021.csv',
            'data/voos_2020.csv',
            'data/voos_2019.csv',
            'data/voos_2018.csv'
        ];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            setupEventListeners();
            
            // Atualizar dados automaticamente a cada 5 minutos
            setInterval(loadAllData, 5 * 60 * 1000);
        });

        // Configurar event listeners
        function setupEventListeners() {
            document.getElementById('aplicarFiltros').addEventListener('click', applyFilters);
            document.getElementById('limparFiltros').addEventListener('click', clearFilters);
            document.getElementById('atualizarDados').addEventListener('click', loadAllData);
            document.getElementById('exportCSV').addEventListener('click', exportToCSV);
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);
            document.getElementById('exportPDF').addEventListener('click', exportToPDF);
            document.getElementById('printDashboard').addEventListener('click', printDashboard);
            
            // Compartilhamento em redes sociais
            document.getElementById('shareFacebook').addEventListener('click', shareOnFacebook);
            document.getElementById('shareTwitter').addEventListener('click', shareOnTwitter);
            document.getElementById('shareLinkedIn').addEventListener('click', shareOnLinkedIn);
            document.getElementById('shareWhatsApp').addEventListener('click', shareOnWhatsApp);
        }

        // Carregar todos os dados dos CSVs
        async function loadAllData() {
            showLoading(true);
            updateDataStatus('Carregando dados...', 'info');
            
            try {
                const allData = [];
                let loadedFiles = 0;
                const totalFiles = CSV_FILES.length;
                
                for (const csvFile of CSV_FILES) {
                    try {
                        const data = await loadCSVFile(csvFile);
                        allData.push(...data);
                        loadedFiles++;
                        updateDataStatus(`Carregando dados... (${loadedFiles}/${totalFiles})`, 'info');
                    } catch (error) {
                        console.warn(`Erro ao carregar ${csvFile}:`, error);
                        // Continua carregando outros arquivos mesmo se um falhar
                    }
                }
                
                flightData = allData;
                filteredData = [...flightData];
                
                lastDataUpdate = new Date();
                updateDashboard();
                updateDataStatus(`Dados carregados com sucesso! ${flightData.length} voos encontrados.`, 'success');
                showLoading(false);
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                updateDataStatus('Erro ao carregar dados. Verifique os arquivos CSV.', 'error');
                showLoading(false);
            }
        }

        // Carregar um arquivo CSV individual
        function loadCSVFile(filePath) {
            return new Promise((resolve, reject) => {
                Papa.parse(filePath, {
                    download: true,
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.errors.length > 0) {
                            console.warn(`Erros no arquivo ${filePath}:`, results.errors);
                        }
                        resolve(results.data || []);
                    },
                    error: function(error) {
                        reject(error);
                    }
                });
            });
        }

        // Atualizar status dos dados
        function updateDataStatus(message, type = 'info') {
            const dataInfo = document.getElementById('dataStatus');
            const lastUpdate = document.getElementById('lastUpdate');
            
            dataInfo.textContent = message;
            dataInfo.className = type === 'error' ? 'text-danger' : type === 'success' ? 'text-success' : 'text-info';
            
            if (lastDataUpdate) {
                lastUpdate.textContent = `Última atualização: ${lastDataUpdate.toLocaleString('pt-BR')}`;
            }
        }

        // Atualizar o dashboard com os dados filtrados
        function updateDashboard() {
            updateSummaryCards();
            updateFlightsTable();
            updatePassengersTable();
            updateCharts();
            updateFilterOptions();
        }

        // Atualizar cards de resumo
        function updateSummaryCards() {
            const totalVoos = filteredData.length;
            const totalHoras = calcularTotalHoras(filteredData);
            const totalPassageiros = calcularTotalPassageiros(filteredData);
            const destinosUnicos = [...new Set(filteredData.map(voo => voo.Destino || voo.destino))].length;

            const summaryHTML = `
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3>${totalVoos}</h3>
                        <p>Voos Realizados</p>
                        <span class="badge-primary">${getVariacaoMensal()} vs mês anterior</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3 class="time-display">${totalHoras}</h3>
                        <p>Horas Voadas</p>
                        <span class="badge-primary">Governador: ${totalHoras}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3>${totalPassageiros}</h3>
                        <p>Passageiros Transportados</p>
                        <span class="badge-primary">Média: ${totalVoos > 0 ? (totalPassageiros / totalVoos).toFixed(1) : '0'} por voo</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3>${destinosUnicos}</h3>
                        <p>Destinos Diferentes</p>
                        <span class="badge-primary">${destinosUnicos} destinos</span>
                    </div>
                </div>
            `;

            document.getElementById('summaryCards').innerHTML = summaryHTML;
        }

        // Atualizar tabela de voos
        function updateFlightsTable() {
            const tableBody = document.getElementById('flightsTableBody');
            const tableFooter = document.getElementById('flightsTableFooter');
            const flightCount = document.getElementById('flightCount');
            const tableTitle = document.getElementById('tableTitle');
            
            flightCount.textContent = `${filteredData.length} voos registrados`;
            tableTitle.textContent = `Detalhamento de Voos - ${getPeriodoFiltro()}`;
            
            let tableHTML = '';
            filteredData.forEach(voo => {
                const data = voo.Data || voo.data;
                const diarioBordo = voo['Diário de Bordo'] || voo.diarioBordo || voo['Número DB'];
                const origem = voo.Origem || voo.origem;
                const destino = voo.Destino || voo.destino;
                const horas = voo['Horas Voadas'] || voo.horas || voo['Horas Voadas'];
                const passageiros = voo.Passageiros || voo.passageiros;
                const aeronave = voo.Aeronave || voo.aeronave;
                const orgao = voo.Órgão || voo.orgao;
                const situacao = voo.Situação || voo.situacao || voo.Despacho;
                
                tableHTML += `
                    <tr>
                        <td>${data || 'N/A'}</td>
                        <td><strong>${diarioBordo || 'N/A'}</strong></td>
                        <td>${origem || 'N/A'} → ${destino || 'N/A'}</td>
                        <td class="time-display">${horas || 'N/A'}</td>
                        <td>${passageiros || '0'}</td>
                        <td>${aeronave || 'N/A'}</td>
                        <td>${orgao || 'N/A'}</td>
                        <td><span class="flight-badge">${situacao || 'N/A'}</span></td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
            const totalHoras = calcularTotalHoras(filteredData);
            const totalPassageiros = calcularTotalPassageiros(filteredData);
            const diasComVoos = [...new Set(filteredData.map(voo => voo.Data || voo.data))].length;
            
            tableFooter.innerHTML = `
                <tr class="table-active">
                    <td colspan="3"><strong>TOTAL GERAL</strong></td>
                    <td class="time-display"><strong>${totalHoras}</strong></td>
                    <td><strong>${totalPassageiros}</strong></td>
                    <td colspan="3"><strong>${diasComVoos} dias com voos</strong></td>
                </tr>
            `;
        }

        // Atualizar tabela de passageiros
        function updatePassengersTable() {
            const tableBody = document.getElementById('passengersTableBody');
            const passengersTitle = document.getElementById('passengersTitle');
            
            passengersTitle.textContent = `Principais Passageiros - ${getPeriodoFiltro()}`;
            
            // Calcular passageiros frequentes
            const passageirosMap = {};
            
            filteredData.forEach(voo => {
                // Esta parte precisaria ser adaptada para a estrutura real do seu CSV
                // Assumindo que cada voo tem informações de passageiros
                const passageiro = voo.Passageiro || voo.Nome;
                if (passageiro) {
                    if (!passageirosMap[passageiro]) {
                        passageirosMap[passageiro] = {
                            nome: passageiro,
                            cargo: voo['Cargo/Função'] || voo.Cargo,
                            orgao: voo.Órgão || voo.orgao,
                            voos: 0,
                            horas: 0
                        };
                    }
                    passageirosMap[passageiro].voos++;
                    // Aqui você precisaria somar as horas voadas
                }
            });
            
            const passageirosFrequentes = Object.values(passageirosMap)
                .sort((a, b) => b.voos - a.voos)
                .slice(0, 10);
            
            let passageirosHTML = '';
            passageirosFrequentes.forEach(passageiro => {
                passageirosHTML += `
                    <tr>
                        <td><strong>${passageiro.nome}</strong></td>
                        <td>${passageiro.cargo || 'N/A'}</td>
                        <td>${passageiro.orgao || 'N/A'}</td>
                        <td>${passageiro.voos}</td>
                        <td class="time-display">${passageiro.horas || 'N/A'}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = passageirosHTML || '<tr><td colspan="5" class="text-center">Nenhum dado de passageiros disponível</td></tr>';
        }

        // Atualizar opções dos filtros
        function updateFilterOptions() {
            updateAnoFilter();
            updateOrigemFilter();
            updateDestinoFilter();
            updateOrgaoFilter();
            updatePeriodoFilter();
        }

        function updateAnoFilter() {
            const anoSelect = document.getElementById('ano');
            const anos = [...new Set(flightData.map(voo => {
                const data = voo.Data || voo.data;
                return data ? data.split('/')[2] : null;
            }))].filter(ano => ano).sort((a, b) => b - a);
            
            let options = '<option value="all" selected>Todos os Anos</option>';
            anos.forEach(ano => {
                options += `<option value="${ano}">${ano}</option>`;
            });
            
            anoSelect.innerHTML = options;
        }

        function updateOrigemFilter() {
            const origemSelect = document.getElementById('origem');
            const origens = [...new Set(flightData.map(voo => voo.Origem || voo.origem))].filter(origem => origem).sort();
            
            let options = '<option value="all" selected>Todas as Origens</option>';
            origens.forEach(origem => {
                options += `<option value="${origem}">${origem}</option>`;
            });
            
            origemSelect.innerHTML = options;
        }

        function updateDestinoFilter() {
            const destinoSelect = document.getElementById('destino');
            const destinos = [...new Set(flightData.map(voo => voo.Destino || voo.destino))].filter(destino => destino).sort();
            
            let options = '<option value="all" selected>Todos os Destinos</option>';
            destinos.forEach(destino => {
                options += `<option value="${destino}">${destino
