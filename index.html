<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voos Oficiais - Governo do Estado de Minas Gerais</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-dark: #29435A;
            --primary-darker: #132837;
            --accent-red: #B93C42;
            --accent-bright: #DB233F;
            --background-light: #EEEFF5;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-light);
            padding-bottom: 20px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .filter-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid var(--accent-red);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
            border: none;
        }
        
        .table-responsive {
            border-radius: 0 0 10px 10px;
        }
        
        .chart-container {
            position: relative;
            height: 320px;
            margin-bottom: 10px;
        }
        
        .summary-card {
            text-align: center;
            padding: 25px 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border-top: 5px solid var(--accent-red);
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }
        
        .summary-card h3 {
            margin: 0;
            font-size: 2.2rem;
            color: var(--primary-dark);
            font-weight: 700;
        }
        
        .summary-card p {
            margin: 8px 0 0;
            color: var(--primary-darker);
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--accent-red), var(--accent-bright));
            border: none;
            padding: 10px 25px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(to right, var(--accent-bright), var(--accent-red));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(219, 35, 63, 0.3);
        }
        
        .btn-outline-secondary {
            border: 2px solid var(--primary-dark);
            color: var(--primary-dark);
            padding: 10px 25px;
            font-weight: 600;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .btn-outline-secondary:hover {
            background-color: var(--primary-dark);
            color: white;
            transform: translateY(-2px);
        }
        
        .table thead th {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-darker) 100%);
            color: white;
            font-weight: 600;
            border: none;
            padding: 15px 12px;
        }
        
        .table tbody tr {
            transition: background-color 0.2s ease;
        }
        
        .table tbody tr:hover {
            background-color: rgba(41, 67, 90, 0.05);
        }
        
        .table tbody td {
            padding: 12px;
            border-color: #e9ecef;
        }
        
        h1 {
            font-weight: 700;
            color: white;
        }
        
        .filter-label {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 10px 12px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--accent-red);
            box-shadow: 0 0 0 0.2rem rgba(185, 60, 66, 0.2);
        }
        
        .badge-primary {
            background-color: var(--accent-red);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: var(--accent-red);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn-export {
            background: white;
            border: 2px solid var(--primary-dark);
            color: var(--primary-dark);
            padding: 8px 15px;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-export:hover {
            background: var(--primary-dark);
            color: white;
            transform: translateY(-2px);
        }
        
        .social-share {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-social {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-facebook { background: #3b5998; }
        .btn-twitter { background: #1da1f2; }
        .btn-linkedin { background: #0077b5; }
        .btn-whatsapp { background: #25d366; }
        
        .btn-social:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .flight-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: #e3f2fd;
            color: #1565c0;
        }
        
        .time-display {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: var(--primary-dark);
        }
        
        .period-filter-container {
            display: flex;
            gap: 15px;
        }
        
        .period-filter-item {
            flex: 1;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .export-buttons {
                width: 100%;
                justify-content: flex-start;
            }
            
            .header-subtitle {
                font-size: 1rem;
            }
            
            .period-filter-container {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
        </div>
    </div>

    <div class="dashboard-header">
        <div class="container">
            <div class="logo-container">
                <div class="logo">MG</div>
                <div>
                    <h1 class="h3 mb-1">Voos Oficiais - Governo do Estado de Minas Gerais</h1>
                    <p class="header-subtitle mb-0">Relatório de Voos de Autoridade</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Filtros -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="ano" class="form-label filter-label">Ano</label>
                        <select class="form-select" id="ano">
                            <option value="all" selected>Todos</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="mes" class="form-label filter-label">Mês</label>
                        <select class="form-select" id="mes">
                            <option value="all" selected>Todos</option>
                            <option value="10">Outubro</option>
                            <option value="9">Setembro</option>
                            <option value="8">Agosto</option>
                            <option value="7">Julho</option>
                            <option value="6">Junho</option>
                            <option value="5">Maio</option>
                            <option value="4">Abril</option>
                            <option value="3">Março</option>
                            <option value="2">Fevereiro</option>
                            <option value="1">Janeiro</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="mb-3">
                        <label for="periodo" class="form-label filter-label">Período Específico</label>
                        <select class="form-select" id="periodo">
                            <option value="all" selected>Todos</option>
                            <option value="2025-10">Outubro 2025</option>
                            <option value="2025-09">Setembro 2025</option>
                            <option value="2025-08">Agosto 2025</option>
                            <option value="2025-07">Julho 2025</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="origem" class="form-label filter-label">Origem</label>
                        <select class="form-select" id="origem">
                            <option value="all" selected>Todas</option>
                            <option value="bh">Belo Horizonte</option>
                            <option value="sp">São Paulo</option>
                            <option value="mc">Montes Claros</option>
                            <option value="ud">Uberlândia</option>
                            <option value="poa">Porto Alegre</option>
                            <option value="rj">Rio de Janeiro</option>
                            <option value="campinas">Campinas</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="destino" class="form-label filter-label">Destino</label>
                        <select class="form-select" id="destino">
                            <option value="all" selected>Todos</option>
                            <option value="bh">Belo Horizonte</option>
                            <option value="sp">São Paulo</option>
                            <option value="mc">Montes Claros</option>
                            <option value="ud">Uberlândia</option>
                            <option value="poa">Porto Alegre</option>
                            <option value="rj">Rio de Janeiro</option>
                            <option value="campinas">Campinas</option>
                            <option value="araxa">Araxá</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="orgao" class="form-label filter-label">Órgão</label>
                        <select class="form-select" id="orgao">
                            <option value="all" selected>Todos</option>
                            <option value="sg">Secretaria-Geral</option>
                            <option value="secom">SECOM</option>
                            <option value="gmg">GMG</option>
                            <option value="segov">SEGOV</option>
                            <option value="sedese">SEDESE</option>
                            <option value="secult">SECULT</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label for="situacao" class="form-label filter-label">Situação</label>
                        <select class="form-select" id="situacao">
                            <option value="all" selected>Todas</option>
                            <option value="realizado">Realizado</option>
                            <option value="planejada">Planejada</option>
                            <option value="cancelada">Cancelada</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <button class="btn btn-primary me-2" id="aplicarFiltros">
                        <i class="fas fa-filter"></i> Aplicar Filtros
                    </button>
                    <button class="btn btn-outline-secondary" id="limparFiltros">
                        <i class="fas fa-redo"></i> Limpar Filtros
                    </button>
                    <button class="btn btn-outline-secondary" id="atualizarDados">
                        <i class="fas fa-sync-alt"></i> Atualizar Dados
                    </button>
                </div>
            </div>
        </div>

        <!-- Cards de Resumo -->
        <div class="row mb-4" id="summaryCards">
            <!-- Os cards serão carregados dinamicamente -->
        </div>

        <!-- Gráficos -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Distribuição de Voos por Destino</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="destinosChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Horas Voadas por Data</h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="horasChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ações de Exportação e Compartilhamento -->
        <div class="action-buttons">
            <div class="export-buttons">
                <button class="btn-export" id="exportCSV">
                    <i class="fas fa-file-csv"></i> Exportar CSV
                </button>
                <button class="btn-export" id="exportExcel">
                    <i class="fas fa-file-excel"></i> Exportar Excel
                </button>
                <button class="btn-export" id="exportPDF">
                    <i class="fas fa-file-pdf"></i> Exportar PDF
                </button>
                <button class="btn-export" id="printDashboard">
                    <i class="fas fa-print"></i> Imprimir
                </button>
            </div>
            
            <div class="social-share">
                <span class="me-2" style="color: var(--primary-dark); font-weight: 500;">Compartilhar:</span>
                <a href="#" class="btn-social btn-facebook" id="shareFacebook" title="Compartilhar no Facebook">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="btn-social btn-twitter" id="shareTwitter" title="Compartilhar no Twitter">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="btn-social btn-linkedin" id="shareLinkedIn" title="Compartilhar no LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="#" class="btn-social btn-whatsapp" id="shareWhatsApp" title="Compartilhar no WhatsApp">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>

        <!-- Tabela de Dados -->
        <div class="card mt-2">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0" id="tableTitle">Detalhamento de Voos</h5>
                <span class="badge-primary" id="flightCount">Carregando...</span>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0" id="flightsTable">
                        <thead class="table-dark">
                            <tr>
                                <th>Data</th>
                                <th>Diário de Bordo</th>
                                <th>Origem → Destino</th>
                                <th>Horas Voadas</th>
                                <th>Passageiros</th>
                                <th>Aeronave</th>
                                <th>Órgão</th>
                                <th>Situação</th>
                            </tr>
                        </thead>
                        <tbody id="flightsTableBody">
                            <!-- Os dados serão carregados dinamicamente -->
                        </tbody>
                        <tfoot id="flightsTableFooter">
                            <!-- O rodapé será carregado dinamicamente -->
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tabela de Passageiros Frequentes -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0" id="passengersTitle">Principais Passageiros</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0" id="passengersTable">
                        <thead class="table-dark">
                            <tr>
                                <th>Passageiro</th>
                                <th>Cargo/Função</th>
                                <th>Órgão</th>
                                <th>Voos Participados</th>
                                <th>Total Horas Voadas</th>
                            </tr>
                        </thead>
                        <tbody id="passengersTableBody">
                            <!-- Os dados serão carregados dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variáveis globais
        let flightData = [];
        let filteredData = [];
        let destinosChart, horasChart;

        // URL do CSV (substitua pela URL real do seu CSV)
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQEXAMPLEPUBLISH/export?format=csv';

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });

        // Configurar event listeners
        function setupEventListeners() {
            document.getElementById('aplicarFiltros').addEventListener('click', applyFilters);
            document.getElementById('limparFiltros').addEventListener('click', clearFilters);
            document.getElementById('atualizarDados').addEventListener('click', loadData);
            document.getElementById('exportCSV').addEventListener('click', exportToCSV);
            document.getElementById('exportExcel').addEventListener('click', exportToExcel);
            document.getElementById('exportPDF').addEventListener('click', exportToPDF);
            document.getElementById('printDashboard').addEventListener('click', printDashboard);
            
            // Compartilhamento em redes sociais
            document.getElementById('shareFacebook').addEventListener('click', shareOnFacebook);
            document.getElementById('shareTwitter').addEventListener('click', shareOnTwitter);
            document.getElementById('shareLinkedIn').addEventListener('click', shareOnLinkedIn);
            document.getElementById('shareWhatsApp').addEventListener('click', shareOnWhatsApp);
        }

        // Carregar dados do CSV
        function loadData() {
            showLoading(true);
            
            // Para este exemplo, vamos usar dados estáticos
            // Em produção, substitua por uma requisição real ao CSV
            setTimeout(() => {
                // Dados de exemplo (substitua pela leitura real do CSV)
                flightData = [
                    { data: '01/10/2025', diarioBordo: '0147-2025', origem: 'São Paulo', destino: 'Belo Horizonte', horas: '01:18h', passageiros: 7, aeronave: 'PP-LCE - PÉGASUS 24', orgao: 'Secretaria-Geral', situacao: 'REALIZADO' },
                    { data: '02/10/2025', diarioBordo: '0148-2025', origem: 'Belo Horizonte', destino: 'Montes Claros', horas: '00:54h', passageiros: 5, aeronave: 'PP-LCE - PÉGASUS 24', orgao: 'Secretaria-Geral', situacao: 'REALIZADO' },
                    { data: '02/10/2025', diarioBordo: '0149-2025', origem: 'Montes Claros', destino: 'Belo Horizonte', horas: '01:00h', passageiros: 5, aeronave: 'PP-LCE - PÉGASUS 24', orgao: 'Secretaria-Geral', situacao: 'REALIZADO' },
                    // Adicione mais dados conforme necessário
                ];
                
                filteredData = [...flightData];
                updateDashboard();
                showLoading(false);
            }, 1000);
            
            // Em produção, use este código para carregar de um CSV real:
            /*
            Papa.parse(CSV_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    flightData = results.data;
                    filteredData = [...flightData];
                    updateDashboard();
                    showLoading(false);
                },
                error: function(error) {
                    console.error('Erro ao carregar dados:', error);
                    showLoading(false);
                    alert('Erro ao carregar dados. Verifique a URL do CSV.');
                }
            });
            */
        }

        // Atualizar o dashboard com os dados filtrados
        function updateDashboard() {
            updateSummaryCards();
            updateFlightsTable();
            updatePassengersTable();
            updateCharts();
        }

        // Atualizar cards de resumo
        function updateSummaryCards() {
            const totalVoos = filteredData.length;
            const totalHoras = calcularTotalHoras(filteredData);
            const totalPassageiros = calcularTotalPassageiros(filteredData);
            const destinosUnicos = [...new Set(filteredData.map(voo => voo.destino))].length;

            const summaryHTML = `
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3>${totalVoos}</h3>
                        <p>Voos Realizados</p>
                        <span class="badge-primary">+18% vs mês anterior</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3 class="time-display">${totalHoras}</h3>
                        <p>Horas Voadas</p>
                        <span class="badge-primary">Governador: ${totalHoras}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3>${totalPassageiros}</h3>
                        <p>Passageiros Transportados</p>
                        <span class="badge-primary">Média: ${(totalPassageiros / totalVoos).toFixed(1)} por voo</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-card">
                        <h3>${destinosUnicos}</h3>
                        <p>Destinos Diferentes</p>
                        <span class="badge-primary">${destinosUnicos - 1} estados + MG</span>
                    </div>
                </div>
            `;

            document.getElementById('summaryCards').innerHTML = summaryHTML;
        }

        // Atualizar tabela de voos
        function updateFlightsTable() {
            const tableBody = document.getElementById('flightsTableBody');
            const tableFooter = document.getElementById('flightsTableFooter');
            const flightCount = document.getElementById('flightCount');
            
            flightCount.textContent = `${filteredData.length} voos registrados`;
            
            let tableHTML = '';
            filteredData.forEach(voo => {
                tableHTML += `
                    <tr>
                        <td>${voo.data}</td>
                        <td><strong>${voo.diarioBordo}</strong></td>
                        <td>${voo.origem} → ${voo.destino}</td>
                        <td class="time-display">${voo.horas}</td>
                        <td>${voo.passageiros}</td>
                        <td>${voo.aeronave}</td>
                        <td>${voo.orgao}</td>
                        <td><span class="flight-badge">${voo.situacao}</span></td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
            const totalHoras = calcularTotalHoras(filteredData);
            const totalPassageiros = calcularTotalPassageiros(filteredData);
            const diasComVoos = [...new Set(filteredData.map(voo => voo.data))].length;
            
            tableFooter.innerHTML = `
                <tr class="table-active">
                    <td colspan="3"><strong>TOTAL GERAL</strong></td>
                    <td class="time-display"><strong>${totalHoras}</strong></td>
                    <td><strong>${totalPassageiros}</strong></td>
                    <td colspan="3"><strong>${diasComVoos} dias com voos</strong></td>
                </tr>
            `;
        }

        // Atualizar tabela de passageiros
        function updatePassengersTable() {
            // Esta função precisaria ser adaptada para seus dados reais
            const tableBody = document.getElementById('passengersTableBody');
            
            // Exemplo estático - em produção, calcule com base nos dados
            const passageirosHTML = `
                <tr>
                    <td><strong>Romeu Zema Neto</strong></td>
                    <td>Governador de Minas Gerais</td>
                    <td>Secretaria-Geral</td>
                    <td>14</td>
                    <td class="time-display">16:24h</td>
                </tr>
                <tr>
                    <td><strong>Eric da Cruz Gonçalves</strong></td>
                    <td>Assessor Especial do Governador</td>
                    <td>SECOM</td>
                    <td>8</td>
                    <td class="time-display">09:42h</td>
                </tr>
            `;
            
            tableBody.innerHTML = passageirosHTML;
        }

        // Atualizar gráficos
        function updateCharts() {
            updateDestinosChart();
            updateHorasChart();
        }

        // Gráfico de destinos
        function updateDestinosChart() {
            const destinosCount = {};
            filteredData.forEach(voo => {
                destinosCount[voo.destino] = (destinosCount[voo.destino] || 0) + 1;
            });
            
            const labels = Object.keys(destinosCount);
            const data = Object.values(destinosCount);
            
            if (destinosChart) {
                destinosChart.destroy();
            }
            
            const destinosCtx = document.getElementById('destinosChart').getContext('2d');
            destinosChart = new Chart(destinosCtx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            'rgba(41, 67, 90, 0.8)',
                            'rgba(185, 60, 66, 0.8)',
                            'rgba(19, 40, 55, 0.8)',
                            'rgba(219, 35, 63, 0.8)',
                            'rgba(41, 67, 90, 0.6)',
                            'rgba(185, 60, 66, 0.6)',
                            'rgba(19, 40, 55, 0.6)',
                            'rgba(219, 35, 63, 0.6)'
                        ],
                        borderColor: [
                            'rgba(41, 67, 90, 1)',
                            'rgba(185, 60, 66, 1)',
                            'rgba(19, 40, 55, 1)',
                            'rgba(219, 35, 63, 1)',
                            'rgba(41, 67, 90, 1)',
                            'rgba(185, 60, 66, 1)',
                            'rgba(19, 40, 55, 1)',
                            'rgba(219, 35, 63, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} voos (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Gráfico de horas voadas
        function updateHorasChart() {
            // Esta função precisaria ser adaptada para seus dados reais
            if (horasChart) {
                horasChart.destroy();
            }
            
            const horasCtx = document.getElementById('horasChart').getContext('2d');
            horasChart = new Chart(horasCtx, {
                type: 'bar',
                data: {
                    labels: ['01/10', '02/10', '03/10', '04/10', '06/10', '25/10', '29/10', '30/10', '31/10'],
                    datasets: [{
                        label: 'Horas Voadas',
                        data: [1.3, 1.9, 2.6, 2.6, 2.2, 1.1, 1.5, 2.3, 0.9],
                        backgroundColor: 'rgba(41, 67, 90, 0.8)',
                        borderColor: 'rgba(41, 67, 90, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Horas'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + 'h';
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const hours = Math.floor(context.raw);
                                    const minutes = Math.round((context.raw - hours) * 60);
                                    return `Horas voadas: ${hours}h${minutes.toString().padStart(2, '0')}m`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Aplicar filtros
        function applyFilters() {
            const ano = document.getElementById('ano').value;
            const mes = document.getElementById('mes').value;
            const periodo = document.getElementById('periodo').value;
            const origem = document.getElementById('origem').value;
            const destino = document.getElementById('destino').value;
            const orgao = document.getElementById('orgao').value;
            const situacao = document.getElementById('situacao').value;
            
            filteredData = flightData.filter(voo => {
                // Filtro por ano
                if (ano !== 'all' && !voo.data.includes(`/${ano}`)) return false;
                
                // Filtro por mês
                if (mes !== 'all') {
                    const mesVoo = voo.data.split('/')[1];
                    if (mesVoo !== mes.padStart(2, '0')) return false;
                }
                
                // Filtro por período específico
                if (periodo !== 'all') {
                    const [anoPeriodo, mesPeriodo] = periodo.split('-');
                    if (!voo.data.includes(`/${mesPeriodo}/${anoPeriodo}`)) return false;
                }
                
                // Filtro por origem
                if (origem !== 'all' && voo.origem.toLowerCase() !== origem.toLowerCase()) return false;
                
                // Filtro por destino
                if (destino !== 'all' && voo.destino.toLowerCase() !== destino.toLowerCase()) return false;
                
                // Filtro por órgão
                if (orgao !== 'all' && voo.orgao.toLowerCase() !== orgao.toLowerCase()) return false;
                
                // Filtro por situação
                if (situacao !== 'all' && voo.situacao.toLowerCase() !== situacao.toLowerCase()) return false;
                
                return true;
            });
            
            updateDashboard();
        }

        // Limpar filtros
        function clearFilters() {
            document.getElementById('ano').value = 'all';
            document.getElementById('mes').value = 'all';
            document.getElementById('periodo').value = 'all';
            document.getElementById('origem').value = 'all';
            document.getElementById('destino').value = 'all';
            document.getElementById('orgao').value = 'all';
            document.getElementById('situacao').value = 'all';
            
            filteredData = [...flightData];
            updateDashboard();
        }

        // Funções auxiliares
        function calcularTotalHoras(voos) {
            // Esta função precisaria ser adaptada para o formato real das horas
            return '16:24h'; // Exemplo
        }

        function calcularTotalPassageiros(voos) {
            return voos.reduce((total, voo) => total + voo.passageiros, 0);
        }

        function showLoading(show) {
            document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
        }

        // Funções de exportação
        function exportToCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Data,Diário de Bordo,Origem,Destino,Horas Voadas,Passageiros,Aeronave,Órgão,Situação\n"
                + filteredData.map(voo => 
                    `"${voo.data}","${voo.diarioBordo}","${voo.origem}","${voo.destino}","${voo.horas}","${voo.passageiros}","${voo.aeronave}","${voo.orgao}","${voo.situacao}"`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "voos_oficiais.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(filteredData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Voos Oficiais");
            XLSX.writeFile(wb, "voos_oficiais.xlsx");
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.text("Relatório de Voos Oficiais - Governo de Minas Gerais", 20, 20);
            doc.text(`Período: ${getPeriodoFiltro()}`, 20, 30);
            doc.text(`Total de voos: ${filteredData.length}`, 20, 40);
            
            // Adicionar tabela
            let y = 60;
            filteredData.forEach((voo, index) => {
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
                doc.text(`${voo.data} - ${voo.origem} → ${voo.destino} - ${voo.horas}`, 20, y);
                y += 10;
            });
            
            doc.save("voos_oficiais.pdf");
        }

        function printDashboard() {
            window.print();
        }

        function getPeriodoFiltro() {
            const ano = document.getElementById('ano').value;
            const mes = document.getElementById('mes').value;
            const periodo = document.getElementById('periodo').value;
            
            if (periodo !== 'all') return periodo;
            if (ano !== 'all' && mes !== 'all') return `${mes}/${ano}`;
            if (ano !== 'all') return `Ano ${ano}`;
            if (mes !== 'all') return `Mês ${mes}`;
            return 'Todos os períodos';
        }

        // Funções de compartilhamento
        function shareOnFacebook(e) {
            e.preventDefault();
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent("Confira o Dashboard de Voos Oficiais do Governo de Minas Gerais");
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank', 'width=600,height=400');
        }

        function shareOnTwitter(e) {
            e.preventDefault();
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent("Confira o Dashboard de Voos Oficiais do Governo de Minas Gerais");
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank', 'width=600,height=400');
        }

        function shareOnLinkedIn(e) {
            e.preventDefault();
            const url = encodeURIComponent(window.location.href);
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank', 'width=600,height=400');
        }

        function shareOnWhatsApp(e) {
            e.preventDefault();
            const text = encodeURIComponent("Confira o Dashboard de Voos Oficiais do Governo de Minas Gerais " + window.location.href);
            window.open(`https://wa.me/?text=${text}`, '_blank', 'width=600,height=400');
        }
    </script>
</body>
</html>